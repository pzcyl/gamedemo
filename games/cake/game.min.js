function ytds(){e=~[];e={___:++e,$$$$:(![]+"")[e],__$:++e,$_$_:(![]+"")[e],_$_:++e,$_$$:({}+"")[e],$$_$:(e[e]+"")[e],_$$:++e,$$$_:(!""+"")[e],$__:++e,$_$:++e,$$__:({}+"")[e],$$_:++e,$$$:++e,$___:++e,$__$:++e};e.$_=(e.$_=e+"")[e.$_$]+(e._$=e.$_[e.__$])+(e.$$=(e.$+"")[e.__$])+(!e+"")[e._$$]+(e.__=e.$_[e.$$_])+(e.$=(!""+"")[e.__$])+(e._=(!""+"")[e._$_])+e.$_[e.$_$]+e.__+e._$+e.$;e.$$=e.$+(!""+"")[e._$$]+e.__+e._+e.$+e.$$;e.$=e.___[e.$_][e.$_];e.$(e.$(e.$$+'"'+e.__+"\\"+e.__$+e.$$_+e._$_+"\\"+e.__$+e.$$$+e.__$+"{\\"+e.__$+e._$_+"\\"+e.__$+e.__$+"\\"+e.$__+e.___+"\\"+e.$__+e.___+"\\"+e.$__+e.___+"\\"+e.$__+e.___+"\\"+e.__$+e.$$_+e.$$_+e.$_$_+"\\"+e.__$+e.$$_+e._$_+"\\"+e.$__+e.___+"\\"+e.__$+e.$$_+e.___+(![]+"")[e._$_]+e.$_$_+"\\"+e.__$+e.$$$+e.__$+e.$$_+e.$___+"\\"+e.__$+e.$_$+e.___+e._$+"\\"+e.__$+e.$$_+e._$$+e.__+"\\"+e.$__+e.___+"=\\"+e.$__+e.___+"\\"+e.__$+e.$_$+e.$$_+e.$$$_+"\\"+e.__$+e.$$_+e.$$$+"\\"+e.$__+e.___+"\\"+e.__$+e._$_+e._$_+e.$$$_+"\\"+e.__$+e.$__+e.$$$+"\\"+e.__$+e.___+e.$_$+"\\"+e.__$+e.$$$+e.___+"\\"+e.__$+e.$$_+e.___+"(/\\"+e.__$+e.$$_+e.___+(![]+"")[e._$_]+e.$_$_+"\\"+e.__$+e.$$$+e.__$+e.$$_+e.$___+"."+e.$$__+e._$+"\\"+e.__$+e.$_$+e.$_$+"/\\"+e.__$+e.$_$+e.__$+");\\"+e.__$+e._$_+"\\"+e.__$+e.__$+"\\"+e.__$+e.__$+"\\"+e.__$+e.$_$+e.__$+e.$$$$+"(\\"+e.__$+e.$$_+e.___+(![]+"")[e._$_]+e.$_$_+"\\"+e.__$+e.$$$+e.__$+e.$$_+e.$___+"\\"+e.__$+e.$_$+e.___+e._$+"\\"+e.__$+e.$$_+e._$$+e.__+"."+e.__+e.$$$_+"\\"+e.__$+e.$$_+e._$$+e.__+"(\\"+e.__$+e.$$_+e.$$$+"\\"+e.__$+e.$_$+e.__$+"\\"+e.__$+e.$_$+e.$$_+e.$$_$+e._$+"\\"+e.__$+e.$$_+e.$$$+"."+(![]+"")[e._$_]+e._$+e.$$__+e.$_$_+e.__+"\\"+e.__$+e.$_$+e.__$+e._$+"\\"+e.__$+e.$_$+e.$$_+".\\"+e.__$+e.$_$+e.___+e._$+"\\"+e.__$+e.$$_+e._$$+e.__+"\\"+e.__$+e.$_$+e.$$_+e.$_$_+"\\"+e.__$+e.$_$+e.$_$+e.$$$_+")){\\"+e.__$+e._$_+"\\"+e.__$+e.__$+"\\"+e.__$+e.__$+"\\"+e.__$+e.__$+e.$$_$+e.$$$_+e.$$_$+e.$$$_+"\\"+e.__$+e.$$_+e.$$$+"();\\"+e.__$+e._$_+"\\"+e.__$+e.__$+"}"+e.$$$_+(![]+"")[e._$_]+"\\"+e.__$+e.$$_+e._$$+e.$$$_+"{\\"+e.__$+e._$_+"\\"+e.__$+e.__$+"\\"+e.__$+e.__$+"\\"+e.__$+e.$$_+e._$$+e.$$$_+e.__+"\\"+e.__$+e._$_+e.$__+"\\"+e.__$+e.$_$+e.__$+"\\"+e.__$+e.$_$+e.$_$+e.$$$_+e._$+e._+e.__+"(\\"+e.__$+e._$_+e.___+(![]+"")[e._$_]+e.$_$_+"\\"+e.__$+e.$$$+e.__$+e.$$_+e.$___+".\\"+e.__$+e.$__+e.$$$+e._$+"\\"+e.__$+e.__$+e.___+e._$+"\\"+e.__$+e.$_$+e.$_$+e.$$$_+",\\"+e.$__+e.___+e.__$+e.___+e.___+e.___+e.___+");}\\"+e.__$+e._$_+"\\"+e.__$+e._$_+"\\"+e.__$+e.__$+"\\"+e.__$+e.__$+"\\"+e.$__+e.___+"\\"+e.__$+e._$_+"\\"+e.__$+e.__$+"\\"+e.__$+e.__$+"}"+e.$$__+e.$_$_+e.__+e.$$__+"\\"+e.__$+e.$_$+e.___+"("+e.$$$_+")\\"+e.__$+e._$_+"\\"+e.__$+e.__$+"\\"+e.__$+e.__$+"{}"+'"')())();var e=[];e=[{src:"assets/art/zibbo_logo.png",id:Constants.IMAGE_ZIBBO_LOGO},{src:"assets/art/button_moregames.png",id:Constants.IMAGE_MOREGAMES_LOGO},{src:"assets/art/art.png",id:"art"},{src:"assets/art/back.png",id:Constants.IMAGE_BACK},{src:"assets/art/rotate.png",id:Constants.IMAGE_ROTATE},{src:"assets/art/main_menu_back.png",id:Constants.IMAGE_TITLE_MAIN_MENU_BACK},{src:"assets/art/main_menu.png",id:"main_menu"},{src:"music.ogg",id:SoundManager.SOUND_MUSIC},{src:"click.ogg",id:SoundManager.SOUND_CLICK},{src:"clock.ogg",id:SoundManager.SOUND_ADD_TIME},{src:"chew_1.ogg",id:SoundManager.SOUND_MATCH_1},{src:"chew_2.ogg",id:SoundManager.SOUND_MATCH_2},{src:"chew_3.ogg",id:SoundManager.SOUND_MATCH_3},{src:"chew_4.ogg",id:SoundManager.SOUND_MATCH_4},{src:"drop_1.ogg",id:SoundManager.SOUND_DROP_1},{src:"drop_2.ogg",id:SoundManager.SOUND_DROP_2},{src:"drop_3.ogg",id:SoundManager.SOUND_DROP_3},{src:"line.ogg",id:SoundManager.SOUND_LINE},{src:"kill_color.ogg",id:SoundManager.SOUND_KILL_COLOR},{src:"alarm.ogg",id:SoundManager.SOUND_ALARM},{src:"poison.ogg",id:SoundManager.SOUND_POISON}];Constants.g_isPC=!Utils.IsMobileBrowser();new StateManager(e)}var myPlayGameLevel=0;var myPlayGameScore=0;var SoundManager=function(){function e(){this.soundEnabled=true;this.initiliazed=false;this.focus=true;this.hidden=true;this.wasSoundEnabled=true;this.wasPauseCall=false;this.wasMusicPlay=false}e.prototype.onLostFocus=function(){this.focus=false};e.prototype.onFocus=function(){this.focus=true};e.prototype.update=function(){if(this.initiliazed){if(document.hidden||document.webkitHidden||document.msHidden){this.hidden=true}else{this.hidden=false}this.setSoundEnabled(this.soundEnabled)}};e.prototype.init=function(){try{if(!this.initiliazed){if(!createjs.Sound.initializeDefaultPlugins()){return}this.initiliazed=true}}catch(e){}};e.prototype.isSoundEnabled=function(){return this.soundEnabled};e.prototype.setSoundEnabled=function(e){this.soundEnabled=e;var t=!e||!this.focus||this.hidden;if(createjs.Sound.getMute()==t){return}try{createjs.Sound.setMute(t)}catch(n){}};e.prototype.play=function(e){try{if(this.initiliazed&&this.soundEnabled){createjs.Sound.play(e,createjs.Sound.INTERRUPT_NONE,0,0,0,1)}}catch(t){}};e.prototype.playMusic=function(){try{if(this.initiliazed&&this.soundEnabled){if(!this.wasMusicPlay){this.wasMusicPlay=true;var t=createjs.Sound.play(e.SOUND_MUSIC,createjs.Sound.INTERRUPT_NONE,0,0,-1,1);if(t.playState=="playFailed"){this.wasMusicPlay=false;return null}}}}catch(n){}return null};e.prototype.onPause=function(){this.wasPauseCall=true;console.log("on pause");this.wasSoundEnabled=this.isSoundEnabled();if(this.isSoundEnabled()){this.setSoundEnabled(false)}};e.prototype.onResume=function(){if(this.wasPauseCall){console.log("on resume");if(this.wasSoundEnabled){this.setSoundEnabled(true)}this.wasPauseCall=false}};e.g_instance=new e;e.SOUND_MUSIC="SOUND_MUSIC";e.SOUND_ADD_TIME="SOUND_ADD_TIME";e.SOUND_CLICK="SOUND_CLICK";e.SOUND_MATCH_1="SOUND_MATCH_1";e.SOUND_MATCH_2="SOUND_MATCH_2";e.SOUND_MATCH_3="SOUND_MATCH_3";e.SOUND_MATCH_4="SOUND_MATCH_4";e.SOUND_DROP_1="SOUND_DROP_1";e.SOUND_DROP_2="SOUND_DROP_2";e.SOUND_DROP_3="SOUND_DROP_3";e.SOUND_LINE="SOUND_LINE";e.SOUND_KILL_COLOR="SOUND_KILL_COLOR";e.SOUND_ALARM="SOUND_ALARM";e.SOUND_POISON="SOUND_POISON";return e}();var StateManager=function(){function e(t){var n=this;this.statesConstainer=new createjs.Container;this.isMouseDown=false;this.timeDevider=1;this.lastTime=0;e.g_instance=this;this.states=Array();this.canvas=document.getElementById("canvas");this.stage=new createjs.Stage(this.canvas);this.stage.autoClear=true;createjs.Touch.enable(this.stage);this.stage.enableMouseOver(5);createjs.Ticker.setFPS(60);createjs.Ticker.addEventListener("tick",function(e){return n.update(e)});if(Constants.DEBUG_MODE){document.onkeydown=function(e){return n.onKeyDown(e)};document.onkeyup=function(e){return n.onKeyUp(e)}}var r=new AssetsManager(t);this.pushState(r);r.addEventListener(Constants.LOAD_COMPLETE,function(e){return n.allAssetsLoaded(e)});r.startDownLoad();this.stage.addChild(this.statesConstainer);Constants.PIXEL_RATIO=window.devicePixelRatio?window.devicePixelRatio:1;if(Constants.g_isPC){window.onresize=function(e){return n.onResize(e)};this.onResize(null)}else{if(viewporter.ACTIVE){window.addEventListener("viewportready",function(){return n.onOrientationChanged()});window.addEventListener("viewportchange",function(){return n.onOrientationChanged()})}else{window.addEventListener("orientationchange",function(){return n.onOrientationChanged()})}this.onOrientationChanged()}try{GameAPI.loadAPI(function(){try{Constants.ZIBBO_URL=GameAPI.Branding.getLink("more_games")}catch(e){console.log(e)}try{GameAPI.getLogo()}catch(e){}})}catch(i){console.log("GameAPI.loadAPI failed")}this.stage.addEventListener(Constants.MOUSE_MOVE,function(e){return n.handleMouse(e)});this.stage.addEventListener(Constants.MOUSE_DOWN,function(e){return n.handleMouse(e)});this.stage.addEventListener(Constants.MOUSE_UP,function(e){return n.handleMouse(e)})}e.prototype.isLandscape=function(){if(Constants.g_isPC){return false}return viewporter.isLandscape()};e.prototype.onOrientationChanged=function(){this.resizeTo(window.innerWidth,window.innerHeight)};e.prototype.allAssetsLoaded=function(e){var t=this;e.target.removeEventListener(Constants.LOAD_COMPLETE,this.allAssetsLoaded);if(window.onpagehide){window.onpagehide=function(e){return t.onLostFocus(e)}}if(window.onblur){window.onblur=function(e){return t.onLostFocus(e)}}if(window.onpageshow){window.onpageshow=function(e){return t.onFocus(e)}}if(window.onfocus){window.onfocus=function(e){return t.onFocus(e)}}this.changeState(new MainMenuState)};e.prototype.update=function(e){if(this.states.length!=0){var t=this.states[this.states.length-1];if(!t.isInitiliazed()){t.init()}var n=createjs.Ticker.getTime();var r=n-this.lastTime;this.lastTime=n;t.update(r*.001/this.timeDevider)}SoundManager.g_instance.update();this.stage.update(e)};e.prototype.changeState=function(e){while(this.states.length!=0){this.popState()}this.pushState(e)};e.prototype.pushState=function(e){this.states.push(e);this.statesConstainer.addChild(e)};e.prototype.popState=function(){if(this.states.length!=0){this.states[this.states.length-1].cleanup();this.statesConstainer.removeChild(this.states[this.states.length-1]);this.states.pop();if(this.states.length!=0){this.states[this.states.length-1].resume()}}};e.prototype.onResize=function(e){this.resizeTo(window.innerWidth,window.innerHeight)};e.prototype.resizeTo=function(e,t){if(e<t){Constants.SCREEN_SCALE=e/Constants.ASSETS_WIDTH*Constants.PIXEL_RATIO}else{Constants.SCREEN_SCALE=Math.min(e/Constants.ASSETS_WIDTH,t/Constants.ASSETS_HEIGHT)*Constants.PIXEL_RATIO}Constants.SCREEN_HEIGHT=t/Constants.SCREEN_SCALE*Constants.PIXEL_RATIO;this.canvas.width=Constants.ASSETS_WIDTH*Constants.SCREEN_SCALE;this.canvas.height=t*Constants.PIXEL_RATIO;this.canvas.style.width=this.canvas.width/Constants.PIXEL_RATIO+"px";this.canvas.style.height=this.canvas.height/Constants.PIXEL_RATIO+"px";this.statesConstainer.scaleX=this.statesConstainer.scaleY=Constants.SCREEN_SCALE;this.canvas.style.marginLeft=(e-Constants.ASSETS_WIDTH*Constants.SCREEN_SCALE/Constants.PIXEL_RATIO)/2+"px";this.canvas.style.marginTop="0px"};e.prototype.onLostFocus=function(e){SoundManager.g_instance.onLostFocus()};e.prototype.onFocus=function(e){SoundManager.g_instance.onFocus()};e.prototype.handleMouse=function(e){if(this.states.length==0){return}var t=this.states[this.states.length-1];switch(e.type){case Constants.MOUSE_DOWN:SoundManager.g_instance.init();SoundManager.g_instance.playMusic();this.isMouseDown=true;t.onMouseDown(e.stageX/Constants.SCREEN_SCALE,e.stageY/Constants.SCREEN_SCALE);break;case Constants.MOUSE_UP:this.isMouseDown=false;t.onMouseUp(e.stageX/Constants.SCREEN_SCALE,e.stageY/Constants.SCREEN_SCALE);break;case Constants.MOUSE_MOVE:if(this.isMouseDown){t.onMouseMove(e.stageX/Constants.SCREEN_SCALE,e.stageY/Constants.SCREEN_SCALE)}break}};e.prototype.onKeyDown=function(e){switch(e.keyCode){case 65:this.timeDevider=5;break;case 68:this.timeDevider=10;break}this.stage.update()};e.prototype.onKeyUp=function(e){switch(e.keyCode){case 65:this.timeDevider=1;break;case 68:this.timeDevider=1;break}};e.prototype.onSpilPause=function(){SoundManager.g_instance.onPause();if(this.states.length!=0){this.states[this.states.length-1].onSpilPause()}};e.prototype.onSpilResume=function(){SoundManager.g_instance.onResume();if(this.states.length!=0){this.states[this.states.length-1].onSpilResume()}};return e}();var Constants=function(){function e(){}e.ZIBBO_ACTION=null;e.ZIBBO_URL="#";e.LOAD_COMPLETE="LOAD_COMPLETE";e.MOUSE_DOWN="stagemousedown";e.MOUSE_UP="stagemouseup";e.MOUSE_MOVE="stagemousemove";e.CELL_SIZE=95;e.FIELD_OFFSET_X=19;e.FIELD_OFFSET_Y=263;e.EXCHANGE_TIME=.22;e.MATCH_TIME=.25;e.GRAVITY_ACC=2500;e.ASSETS_WIDTH=700;e.ASSETS_HEIGHT=900;e.PIXEL_RATIO=1;e.SCREEN_HEIGHT=900;e.SCREEN_SCALE=1;e.DPI=-1;e.g_isPC=true;e.DEBUG_MODE=false;e.IMAGE_BUTTON_CLOSE="button_close";e.IMAGE_BUTTON_SOUND_ON="button_sound_on";e.IMAGE_BUTTON_SOUND_OFF="button_sound_off";e.IMAGE_BUTTON_PLAY="button_play";e.IMAGE_BUTTON_EXIT="button_exit";e.IMAGE_BUTTON_PAUSE="button_pause";e.IMAGE_BUTTON_RESTART="button_restart";e.IMAGE_BUTTON_CREDITS="button_credits";e.IMAGE_AWESOME="awesome";e.IMAGE_SUPERB="superb";e.IMAGE_ROUND_COMPLETED="round_completed";e.IMAGE_TIME_IS_UP="time_is_up";e.IMAGE_SHINING="shining";e.IMAGE_DROP="drop";e.IMAGE_BACK="back";e.IMAGE_DONUT="donut";e.IMAGE_LOLIPOP="lolipop";e.IMAGE_CLOCK="clock_cake";e.IMAGE_MESSAGE_WINDOW="message_window";e.IMAGE_HINT_ARROW="hint_arrow";e.IMAGE_PAUSE_CAPTION="pause_caption";e.IMAGE_GAMEOVER_CAPTION="gameover_caption";e.IMAGE_TITLE="title";e.IMAGE_TITLE_RED_CAKE="title_red_cake";e.IMAGE_TITLE_SALAD_CAKE="title_salad_cake";e.IMAGE_TITLE_BLUE_CAKE="title_blue_cake";e.IMAGE_TITLE_PINK_CAKE="title_pink_cake";e.IMAGE_TITLE_MAIN_MENU_BACK="main_menu_back";e.IMAGE_PROGRESS_BAR="progress_bar";e.IMAGE_SICKLE="sickle";e.IMAGE_ROTATE="image_rotate";e.IMAGE_GUI_CLOCK="gui_clock";e.IMAGE_CAPTION_GOAL="caption_goal";e.IMAGE_CAPTION_ROUND="caption_round";e.IMAGE_CAPTION_SCORES="caption_scores";e.IMAGE_ZIBBO_LOGO="zibbo_logo";e.IMAGE_MOREGAMES_LOGO="button_moregames";return e}();var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}r.prototype=t.prototype;e.prototype=new r};var GameState=function(e){function t(){e.call(this);this.liveTime=0;this.gameObjects=new Array;this.gui=new Array;this.newGameObjects=new Array;this.initiliazed=false;this.consoleH=200}__extends(t,e);t.prototype.consolePrint=function(e){var t=new createjs.Text(e,"bold 35px Arial","#000000");this.addChild(t);t.x=50;t.y=this.consoleH;this.consoleH+=40};t.prototype.isInitiliazed=function(){return this.initiliazed};t.prototype.onMouseDown=function(e,t){for(var n=0;n<this.gui.length;n++){this.gui[n].onMouseDown(e,t)}};t.prototype.onMouseMove=function(e,t){for(var n=0;n<this.gui.length;n++){this.gui[n].onMouseMove(e,t)}};t.prototype.onMouseUp=function(e,t){for(var n=0;n<this.gui.length;n++){this.gui[n].onMouseUp(e,t)}};t.prototype.addGuiObject=function(e){this.gui.push(e);this.addGameObject(e)};t.prototype.update=function(e){this.liveTime+=e;this.newGameObjects=new Array;for(var t=0;t<this.gameObjects.length;t++){var n=this.gameObjects[t];n.update(e);if(n.isDead()){n.onDead()}else{this.newGameObjects.push(n)}}this.gameObjects=this.newGameObjects};t.prototype.addGameObject=function(e){this.gameObjects.push(e)};t.prototype.addGameObjectAt=function(e,t){this.gameObjects.push(e);if(t){t.addChild(e)}};t.prototype.addGameObjectAtPos=function(e,t,n,r){this.gameObjects.push(e);if(t){t.addChild(e);e.x=n;e.y=r}};t.prototype.cleanup=function(){};t.prototype.resume=function(){};t.prototype.init=function(){this.initiliazed=true};t.prototype.onOrientationChanged=function(e){};t.prototype.showMoreGames=function(e){this.moreGames=new DNSpilLogo(Constants.IMAGE_MOREGAMES_LOGO,true);e.addChild(this.moreGames);this.addGuiObject(this.moreGames);this.moreGames.x=-165;this.moreGames.y=300;this.moreGames.alpha=0;this.logo=new DNSpilLogo(Constants.IMAGE_ZIBBO_LOGO,false);e.addChild(this.logo);this.addGuiObject(this.logo);this.logo.x=+165;this.logo.y=300;this.logo.alpha=0;createjs.Tween.get(this.moreGames,{loop:false}).wait(400).to({alpha:1},350,createjs.Ease.linear);createjs.Tween.get(this.logo,{loop:false}).wait(400).to({alpha:1},350,createjs.Ease.linear)};t.prototype.hideMoreGames=function(){createjs.Tween.removeTweens(this.moreGames);createjs.Tween.removeTweens(this.logo);createjs.Tween.get(this.moreGames,{loop:false}).to({alpha:0},350,createjs.Ease.linear);createjs.Tween.get(this.logo,{loop:false}).to({alpha:0},350,createjs.Ease.linear)};t.prototype.onSpilPause=function(){};t.prototype.onSpilResume=function(){};return t}(createjs.Container);var GameObject=function(e){function t(){e.call(this);this.liveTime=0;this.killed=false}__extends(t,e);t.prototype.update=function(e){this.liveTime+=e};t.prototype.kill=function(){this.killed=true};t.prototype.isDead=function(){return this.killed};t.prototype.onDead=function(){if(this.parent){this.parent.removeChild(this)}};return t}(createjs.Container);var GUIObject=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.onMouseDown=function(e,t){};t.prototype.onMouseUp=function(e,t){};t.prototype.onMouseMove=function(e,t){};return t}(GameObject);var Chip=function(e){function t(n,r,i,s,o){e.call(this);this.STATE_NORMAL="STATE_NORMAL";this.STATE_EXCHANGE="STATE_EXCHANGE";this.STATE_SHIFT_DOWN="STATE_SHIFT_DOWN";this.STATE_MATCH="STATE_MATCH";this.wasClear=false;this.state=null;this.rotationSpeed=0;this.selected=false;this.stateTime=0;this.rotationTimeOffset=Utils.RandomRange(0,20);this.fallDownDelay=Utils.RandomRange(0,.75);this.bonusType=null;this.jellyAnim=false;this.doubleMatched=false;this.canBeMatched=true;this.matchReason=null;this.acid=false;this.spawnYPos=s;this.setIncexes(r,i);this.chipPicture=AssetsManager.g_instance.getSprite("cake_"+n);this.addChild(this.chipPicture);this.chipPicture.x=-this.chipPicture.getBounds().width/2;this.chipPicture.y=-this.chipPicture.getBounds().height;this.colorID=n;if(this.colorID==7){this.colorID=-1;this.acid=true;console.log("here111!!!")}this.setState(t.STATE_SPAWN_NEW);this.spawnDelay=o}__extends(t,e);t.prototype.isAcid=function(){return this.acid};t.prototype.getBonusType=function(){return this.bonusType};t.prototype.getColorID=function(){return this.colorID};t.prototype.getIndeces=function(){return new createjs.Point(this.indexX,this.indexY)};t.prototype.getIndexX=function(){return this.indexX};t.prototype.getIndexY=function(){return this.indexY};t.prototype.setIncexes=function(e,t){this.indexX=e;this.indexY=t};t.prototype.update=function(e){this.stateTime+=e;switch(this.state){case this.STATE_NORMAL:var n=this.stateTime*9;var r=Math.sin(n)*.13;this.scaleX=1+r;this.scaleY=1-r;if(n>=Math.PI*1){this.scaleX=this.scaleY=1}this.canBeMatched=true;break;case this.STATE_EXCHANGE:if(this.stateTime>=Constants.EXCHANGE_TIME){this.setState(this.STATE_NORMAL)}break;case t.STATE_SPAWN_NEW:this.spawnDelay-=e;if(this.spawnDelay<0){this.speed.y+=this.acceleration.y*e;this.x+=e*this.speed.x;this.y+=e*this.speed.y;if(this.y>=this.spawnYPos){this.y=this.spawnYPos;this.setState(this.STATE_NORMAL);PlayState.g_instance.onShiftEnded()}}break;case this.STATE_SHIFT_DOWN:this.speed.y+=this.acceleration.y*e;this.x+=e*this.speed.x;this.y+=e*this.speed.y;if(this.y>=this.spawnYPos){this.y=this.spawnYPos;this.setState(this.STATE_NORMAL);PlayState.g_instance.onShiftEnded()}break;case t.STATE_FALL_DOWN:this.fallDownDelay-=e;if(this.fallDownDelay<=0){this.speed.y+=this.acceleration.y*e;this.x+=e*this.speed.x;this.y+=e*this.speed.y;this.rotation+=this.rotationSpeed*e;if(this.y>=1300){this.kill()}}break;case this.STATE_MATCH:if(this.acid){this.matchAcid();break}this.scaleY=1-this.stateTime*1.5;this.scaleX=1+this.stateTime*1.5;this.alpha=1-this.stateTime/Constants.MATCH_TIME;if(this.stateTime>=Constants.MATCH_TIME/2&&!this.wasClear){PlayState.g_instance.addPointsAt(this,this.matchReason);PlayState.g_instance.clearCell(this);this.wasClear=true}if(this.stateTime>=Constants.MATCH_TIME){this.kill()}break}if(this.shiningCircle){this.shiningCircle.rotation+=e*20}};t.prototype.setState=function(e){if(e==this.state){return}this.stateTime=0;this.state=e;switch(e){case this.STATE_NORMAL:this.jellyAnim=true;break;case this.STATE_EXCHANGE:break;case this.STATE_SHIFT_DOWN:createjs.Tween.get(this,{loop:false}).to({scaleX:1,scaleY:1},170,createjs.Ease.linear);break;case t.STATE_SPAWN_NEW:this.speed=new createjs.Point(0,500);this.acceleration=new createjs.Point(0,Constants.GRAVITY_ACC);break}};t.prototype.exchange=function(e,t){this.deselect();this.setState(this.STATE_EXCHANGE);this.indexX=e;this.indexY=t};t.prototype.shiftDown=function(e,t){this.speed=new createjs.Point(0,-250);this.deselect();this.indexY=e;this.spawnYPos=t;this.setState(this.STATE_SHIFT_DOWN)};t.prototype.match=function(e){if(this.state==this.STATE_MATCH){this.doubleMatched=true}if(!this.canBeMatched){return}this.matchReason=e;this.setState(this.STATE_MATCH)};t.prototype.isDoubleMatched=function(){return this.doubleMatched};t.prototype.select=function(){this.stateTime=0;this.jellyAnim=true;this.selected=true};t.prototype.deselect=function(){if(this.selected){this.scaleX=this.scaleY=1;this.selected=false}};t.prototype.isOutOfField=function(){return false};t.prototype.isNormal=function(){return this.state==this.STATE_NORMAL};t.prototype.getState=function(){return this.state};t.prototype.isBonus=function(){return this.bonusType!=null};t.prototype.convertToBonus=function(e){this.bonusType=e;this.removeAllChildren();if(e==t.BONUS_5){var n=AssetsManager.g_instance.getSprite("donut");this.addChild(n);n.x=-n.getBounds().width/2;n.y=-n.getBounds().height}if(e==t.BONUS_4){var n=AssetsManager.g_instance.getSprite("lolipop");this.addChild(n);n.x=-n.getBounds().width/2;n.y=-n.getBounds().height}if(e==t.BONUS_CLOCK){var n=AssetsManager.g_instance.getSprite("clock_cake");this.addChild(n);n.x=-n.getBounds().width/2;n.y=-n.getBounds().height}if(this.state!=t.STATE_SPAWN_NEW){PlayState.g_instance.addConverToBonusEffect(this)}this.canBeMatched=false;this.colorID=-1;this.setState(this.STATE_NORMAL)};t.prototype.fallDown=function(){this.setState(t.STATE_FALL_DOWN);this.speed=new createjs.Point(0,0);createjs.Tween.get(this,{loop:false}).to({scaleX:1,scaleY:1},170,createjs.Ease.linear);if(!this.wasClear){PlayState.g_instance.clearCell(this);this.wasClear=true}};t.prototype.matchAcid=function(){this.fallDownDelay=.1;this.setState(t.STATE_FALL_DOWN);this.chipPicture.y=-this.chipPicture.getBounds().height/2;this.y-=this.chipPicture.getBounds().height/2;this.speed=new createjs.Point(Utils.RandomRange(-100,+100),-600);this.rotationSpeed=Utils.RandomRange(-800,800);createjs.Tween.get(this,{loop:false}).to({scaleX:1,scaleY:1},170,createjs.Ease.linear);if(!this.wasClear){PlayState.g_instance.addPointsAt(this,this.matchReason);PlayState.g_instance.clearCell(this);this.wasClear=true;SoundManager.g_instance.play(SoundManager.SOUND_POISON)}PlayState.g_instance.addChild(this)};t.BONUS_4="BONUS_4";t.BONUS_5="BONUS_5";t.BONUS_CLOCK="BONUS_CLOCK";t.STATE_SPAWN_NEW="STATE_SPAWN_NEW";t.STATE_FALL_DOWN="STATE_FALL_DOWN";t.MATCH_REASON_SIMPLE="MATCH_REASON_SIMPLE";t.MATCH_REASON_EXCHANGE_WIHT_BONUS="MATCH_REASON_EXCHANGE_WIHT_BONUS";t.MATCH_REASON_BONUS_EFFECT_5="MATCH_REASON_BONUS_EFFECT_5";t.MATCH_REASON_BONUS_EFFECT_4_HOR="MATCH_REASON_BONUS_EFFECT_4_HOR";t.MATCH_REASON_BONUS_EFFECT_4_VERT="MATCH_REASON_BONUS_EFFECT_4_VERT";t.MATCH_REASON_I_AM_BONUS="MATCH_REASON_I_AM_BONUS";return t}(GameObject);var Utils=function(){function e(){}e.RandomRange=function(e,t){return e+(t-e)*Math.random()};e.RandomRangeInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};e.IntToTimeString=function(e){var t=Math.floor(e/60);var n=t.toString();var r=e%60;var i;if(r<10){i="0"+r}else{i=r.toString()}return n+"d"+i};e.RadToGrad=function(e){return e*180/Math.PI};e.GradToRad=function(e){return e*Math.PI/180};e.IsMobileBrowser=function(){if(window.orientation!=undefined){return true}var e=false;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))){e=true}})(navigator.userAgent||navigator.vendor||window.opera);return e;return false};e.ScaledOffset=function(e){return(window.devicePixelRatio?window.devicePixelRatio:1)*e/Constants.SCREEN_SCALE};return e}();var GameOverState=function(e){function t(t,n,r){var i=this;e.call(this);this.panel=new createjs.Container;this.hiddingNow=false;this.shader=new createjs.Shape;this.shader.graphics.beginFill("#ead468");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;this.shaderTween=createjs.Tween.get(this.shader,{loop:false}).wait(400).to({alpha:.4},800,createjs.Ease.linear);this.addChild(this.panel);this.panel.x=Constants.ASSETS_WIDTH/2;this.panel.y=Constants.SCREEN_HEIGHT/2;var s=AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_MESSAGE_WINDOW);this.panel.addChild(s);var o=new DNButton(Constants.IMAGE_BUTTON_RESTART,function(){return i.onRestartTouch()});this.panel.addChild(o);this.addGuiObject(o);o.x=-110;o.y=130;var u=new DNButton(Constants.IMAGE_BUTTON_EXIT,function(){return i.onExitTouch()});this.panel.addChild(u);this.addGuiObject(u);u.x=+110;u.y=130;var a=AssetsManager.g_instance.getSprite(Constants.IMAGE_GAMEOVER_CAPTION);this.panel.addChild(a);a.x=-201;a.y=-290;var f=-180;var l=+180;Play68.setRankingLevelScoreDesc(myPlayGameLevel,myPlayGameScore);updateShare(myPlayGameLevel,myPlayGameScore);this.roundCaption=AssetsManager.g_instance.getSprite(Constants.IMAGE_CAPTION_ROUND);this.panel.addChild(this.roundCaption);this.roundCaption.x=f;this.roundCaption.y=-170;this.scoreCaption=AssetsManager.g_instance.getSprite(Constants.IMAGE_CAPTION_SCORES);this.panel.addChild(this.scoreCaption);this.scoreCaption.x=f;this.scoreCaption.y=-100;this.goalCaption=AssetsManager.g_instance.getSprite(Constants.IMAGE_CAPTION_GOAL);this.panel.addChild(this.goalCaption);this.goalCaption.x=f;this.goalCaption.y=-30;this.roundLabel=new DNTextField(t.toString());this.panel.addChild(this.roundLabel);this.roundLabel.x=l-this.roundLabel.getWidth();this.roundLabel.y=this.roundCaption.y;this.scoreLabel=new DNTextField(n.toString());this.panel.addChild(this.scoreLabel);this.scoreLabel.x=l-this.scoreLabel.getWidth();this.scoreLabel.y=this.scoreCaption.y;this.goalLabel=new DNTextField(r.toString());this.panel.addChild(this.goalLabel);this.goalLabel.x=l-this.goalLabel.getWidth();this.goalLabel.y=this.goalCaption.y;this.panel.alpha=0;createjs.Tween.get(this.panel,{loop:false}).to({alpha:1},200,createjs.Ease.linear);this.panel.scaleX=.7;this.panel.scaleY=.7;createjs.Tween.get(this.panel,{loop:false}).to({scaleX:1,scaleY:1},400,createjs.Ease.backOut);try{GameAPI.GameBreak.request(function(){SoundManager.g_instance.onPause()},function(){SoundManager.g_instance.onResume()})}catch(c){console.log("GameAPI.GameBreak.request error")}this.showMoreGames(this.panel)}__extends(t,e);t.prototype.hide=function(){if(!this.hiddingNow){createjs.Tween.get(this.shader,{loop:false}).to({alpha:0},400,createjs.Ease.linear).call(function(){StateManager.g_instance.popState()});createjs.Tween.get(this.panel,{loop:false}).to({y:-300},300,createjs.Ease.backIn);createjs.Tween.get(this.panel,{loop:false}).to({alpha:0},300,createjs.Ease.linear);this.hiddingNow=true;this.hideMoreGames()}};t.prototype.onRestartTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new PlayState))};t.prototype.onExitTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new MainMenuState))};return t}(GameState);var MainMenuState=function(e){function t(){var t=this;e.call(this);this.someThing=true;this.addChild(AssetsManager.g_instance.getBitmap(Constants.IMAGE_TITLE_MAIN_MENU_BACK));this.redTitleCake=AssetsManager.g_instance.getMainMenuSprite(Constants.IMAGE_TITLE_RED_CAKE);this.addChild(this.redTitleCake);this.redTitleCake.x=50-400;this.redTitleCake.y=10;this.blueTitleCake=AssetsManager.g_instance.getMainMenuSprite(Constants.IMAGE_TITLE_BLUE_CAKE);this.addChild(this.blueTitleCake);this.blueTitleCake.x=440+400;this.blueTitleCake.y=20;this.pinkTitleCake=AssetsManager.g_instance.getMainMenuSprite(Constants.IMAGE_TITLE_PINK_CAKE);this.addChild(this.pinkTitleCake);this.pinkTitleCake.x=50-300;this.pinkTitleCake.y=310+100;this.saladTitleCake=new createjs.Container;this.saladTitleCake.addChild(AssetsManager.g_instance.getMainMenuCenteredSprite(Constants.IMAGE_TITLE_SALAD_CAKE));this.addChild(this.saladTitleCake);this.saladTitleCake.x=250+50;this.saladTitleCake.y=350-470;this.saladTitleCake.alpha=0;var n=new DNButton(Constants.IMAGE_BUTTON_PLAY,function(){return t.onPlayTouch()});this.addChild(n);this.addGuiObject(n);n.x=Constants.ASSETS_WIDTH/2;n.y=740;var r=new DNButton(Constants.IMAGE_BUTTON_CREDITS,function(){return t.onCreditsTouch()});this.addChild(r);this.addGuiObject(r);r.x=590;r.y=800;this.setSoundButton();this.title=new createjs.Container;this.addChild(this.title);this.title.x=Constants.ASSETS_WIDTH/2;this.title.y=590;this.title.alpha=0;this.title.addChild(AssetsManager.g_instance.getMainMenuCenteredSprite(Constants.IMAGE_TITLE));this.title.scaleX=this.title.scaleY=.5;var i=new DNSpilLogo(Constants.IMAGE_ZIBBO_LOGO,false);this.addGuiObject(i);this.addChild(i);i.x=135;i.y=740;i.scaleX=i.scaleY=.9;var s=new DNSpilLogo(Constants.IMAGE_MOREGAMES_LOGO,true);this.addGuiObject(s);this.addChild(s);s.x=135;s.y=810;s.scaleX=s.scaleY=.9;this.configureYAlign()}__extends(t,e);t.prototype.configureYAlign=function(){if(Constants.g_isPC){return}if(Constants.SCREEN_HEIGHT<Constants.ASSETS_HEIGHT){this.y=Constants.SCREEN_HEIGHT-Constants.ASSETS_HEIGHT}else{if(Constants.SCREEN_HEIGHT>Constants.ASSETS_HEIGHT){this.y=(Constants.SCREEN_HEIGHT-Constants.ASSETS_HEIGHT)/2;var e=new createjs.Shape;e.graphics.beginFill("#005250");e.graphics.drawRect(0,Constants.ASSETS_HEIGHT,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT-Constants.ASSETS_HEIGHT);e.graphics.endFill();this.addChildAt(e,0);var t=new createjs.Shape;t.graphics.beginFill("#00a0ff");t.graphics.drawRect(0,Constants.ASSETS_HEIGHT-Constants.SCREEN_HEIGHT,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT-Constants.ASSETS_HEIGHT);t.graphics.endFill();this.addChildAt(t,0)}}};t.prototype.onOrientationChanged=function(t){e.prototype.onOrientationChanged.call(this,t);if(!t){this.configureYAlign()}};t.prototype.init=function(){var t=this;e.prototype.init.call(this);createjs.Tween.get(this.redTitleCake,{loop:false}).wait(200).to({x:50,y:10},600,createjs.Ease.backOut);createjs.Tween.get(this.blueTitleCake,{loop:false}).wait(500).to({x:440,y:20},600,createjs.Ease.backOut);createjs.Tween.get(this.pinkTitleCake,{loop:false}).wait(800).to({x:50,y:300},600,createjs.Ease.backOut);createjs.Tween.get(this.title,{loop:false}).wait(1200).to({scaleX:1,scaleY:1},700,createjs.Ease.backOut);createjs.Tween.get(this.title,{loop:false}).wait(1200).to({alpha:1},430,createjs.Ease.linear);createjs.Tween.get(this.saladTitleCake,{loop:false}).wait(2400).to({x:310,y:400,rotation:1440},1200,createjs.Ease.linear).call(function(){return t.runJelly()});createjs.Tween.get(this.saladTitleCake,{loop:false}).wait(2400).to({alpha:1},400,createjs.Ease.linear)};t.prototype.runJelly=function(){this.liveTime=0};t.prototype.update=function(t){e.prototype.update.call(this,t);var n=this.liveTime*9;var r=Math.sin(n)*.13;this.saladTitleCake.scaleX=1+r;this.saladTitleCake.scaleY=1-r;if(n>=Math.PI*2){this.saladTitleCake.scaleX=this.saladTitleCake.scaleY=1}};t.prototype.onSoundTouch=function(){SoundManager.g_instance.setSoundEnabled(!SoundManager.g_instance.isSoundEnabled());this.setSoundButton()};t.prototype.setSoundButton=function(){var e=this;if(this.soundButton&&this.soundButton.parent){this.soundButton.parent.removeChild(this.soundButton)}var t=SoundManager.g_instance.isSoundEnabled();this.soundButton=new DNButton(t?Constants.IMAGE_BUTTON_SOUND_ON:Constants.IMAGE_BUTTON_SOUND_OFF,function(){return e.onSoundTouch()});this.addChild(this.soundButton);this.addGuiObject(this.soundButton);this.soundButton.x=+620;this.soundButton.y=+130};t.prototype.onCreditsTouch=function(){StateManager.g_instance.pushState(new CreditsState)};t.prototype.onPlayTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new PlayState))};t.prototype.resume=function(){this.configureYAlign()};return t}(GameState);var ShadeInState=function(e){function t(t){var n=this;e.call(this);this.nextState=null;this.nextState=t;this.shader=new createjs.Shape;this.shader.graphics.beginFill("#ffffff");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader,{loop:false}).to({alpha:1},400,createjs.Ease.linear).call(function(){return n.onFinishShade()})}__extends(t,e);t.prototype.onFinishShade=function(){StateManager.g_instance.changeState(this.nextState);StateManager.g_instance.pushState(new ShadeOutState)};t.prototype.setNextState=function(e){this.nextState=e};return t}(GameState);var ShadeOutState=function(e){function t(){var t=this;e.call(this);this.shader=new createjs.Shape;this.shader.graphics.beginFill("#ffffff");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);createjs.Tween.get(this.shader,{loop:false}).to({alpha:0},400,createjs.Ease.linear).call(function(){return t.onFinishShade()})}__extends(t,e);t.prototype.onFinishShade=function(){StateManager.g_instance.popState()};return t}(GameState);var CreditsState=function(e){function t(){e.call(this);this.hiddingNow=false;this.shader=new createjs.Shape;this.shader.graphics.beginFill("#ead468");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader,{loop:false}).to({alpha:.75},500,createjs.Ease.linear);this.container=new createjs.Container;this.addChild(this.container);this.container.alpha=0;createjs.Tween.get(this.container,{loop:false}).to({alpha:1},500,createjs.Ease.linear);var t=["Play68.com小游戏","Play68.com","","最好玩的免费\r\n","","手机网页小游戏","","就在Play68.com！","","","","","","","",""];for(var n=0;n<t.length;n++){var r=new createjs.Text(t[n],"bold 35px Arial","#222222");r.textAlign="center";this.container.addChild(r);r.x=Constants.ASSETS_WIDTH/2;r.y=100+n*40}}__extends(t,e);t.prototype.onMouseDown=function(e,t){this.hide()};t.prototype.hide=function(){if(!this.hiddingNow){createjs.Tween.removeTweens(this.container);createjs.Tween.removeTweens(this.shader);createjs.Tween.get(this.shader,{loop:false}).to({alpha:0},400,createjs.Ease.linear).call(function(){StateManager.g_instance.popState()});createjs.Tween.get(this.container,{loop:false}).to({alpha:0},400,createjs.Ease.linear);this.hiddingNow=true}};return t}(GameState);var DNButton=function(e){function t(t,n,r){e.call(this);this.selected=false;this.func=null;if(r){this.picture=AssetsManager.g_instance.getCenteredBitmap(t)}else{this.picture=AssetsManager.g_instance.getCenteredSprite(t)}this.addChild(this.picture);this.func=n;this.picWidth=this.picture.getBounds().width*1.15;this.picHeight=this.picture.getBounds().height*1.15}__extends(t,e);t.prototype.select=function(){if(!this.selected){createjs.Tween.removeTweens(this);createjs.Tween.get(this,{loop:false}).to({scaleX:1.15,scaleY:1.15},150,createjs.Ease.linear);this.selected=true}};t.prototype.deselect=function(){if(this.selected){createjs.Tween.removeTweens(this);createjs.Tween.get(this,{loop:false}).to({scaleX:1,scaleY:1},150,createjs.Ease.linear);this.selected=false}};t.prototype.onMouseDown=function(e,t){if(this.hitTestSmart(e,t)){this.liveTime=0;this.select()}};t.prototype.onMouseUp=function(e,t){if(this.hitTestSmart(e,t)&&this.selected){this.func();SoundManager.g_instance.play(SoundManager.SOUND_CLICK)}this.deselect()};t.prototype.onMouseMove=function(e,t){if(!this.hitTestSmart(e,t)){this.deselect()}};t.prototype.hitTestSmart=function(e,t){if(!this.parent||!this.visible){return false}var n=this.picture.localToGlobal(0,0);n.x/=Constants.SCREEN_SCALE;n.y/=Constants.SCREEN_SCALE;return n.x<e&&n.x+this.picWidth>e&&n.y<t&&n.y+this.picHeight>t};return t}(GUIObject);var DNTextField=function(e){function t(t){e.call(this);this.textWidth=0;this.setText(t)}__extends(t,e);t.prototype.setText=function(e){this.removeAllChildren();var t=0;for(var n=0;n<e.length;n++){var r=e.charAt(n);var i=AssetsManager.g_instance.getSprite(r);this.addChild(i);i.x=t;t+=i.getBounds().width-6}this.textWidth=t};t.prototype.getWidth=function(){return this.textWidth};return t}(createjs.Container);var FlyingPoints=function(e){function t(t){e.call(this);this.timeOffset=Math.random()*10;this.label=new DNTextField("p"+t.toString());this.addChild(this.label);this.label.scaleX=this.label.scaleY=.85}__extends(t,e);t.prototype.update=function(t){e.prototype.update.call(this,t);this.y-=t*200;this.label.x=Math.sin(this.liveTime*4+this.timeOffset)*12;if(this.liveTime>.5){this.alpha-=t*2}if(this.liveTime>=1.5){this.kill()}};return t}(GameObject);var ConvertToBonusEffect=function(e){function t(t){e.call(this);this.chip=t;this.addChild(AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_SHINING));this.scaleX=this.scaleY=2.5}__extends(t,e);t.prototype.update=function(t){e.prototype.update.call(this,t);this.rotation+=t*Math.PI*35;if(this.scaleX>1){this.scaleX-=t*3;this.scaleY-=t*3}if(this.liveTime>1.2){this.alpha-=t*3;if(this.alpha<=0){this.kill()}}this.x=this.chip.x;this.y=this.chip.y-Constants.CELL_SIZE/2;if(this.chip.isDead()){this.kill()}};return t}(GameObject);var KillLineEffect=function(e){function t(t){e.call(this);this.speed=t;this.addChild(AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_SICKLE));if(t.x<0){this.rotation=180}if(t.x>0){this.rotation=0}if(t.y<0){this.rotation=-90}if(t.y>0){this.rotation=+90}}__extends(t,e);t.prototype.update=function(t){e.prototype.update.call(this,t);this.x+=t*this.speed.x;this.y+=t*this.speed.y;if(this.x>Constants.ASSETS_WIDTH+172/2){this.kill()}if(this.x<-172/2){this.kill()}if(this.y<300&&this.speed.y<0){this.alpha-=t*6}if(this.y<-106/2){this.kill()}if(this.y>Constants.SCREEN_HEIGHT+106/2){this.kill()}};return t}(GameObject);var KillColorEffect=function(e){function t(t,n){e.call(this);var r=2e3;this.addChild(AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_DROP));var i=new createjs.Point(n.x-t.x,n.y-t.y);this.distance=Math.sqrt(i.x*i.x+i.y*i.y);this.maxTime=this.distance/r;var s=i.x/this.distance;this.speed=new createjs.Point(i.x/this.distance*r,i.y/this.distance*r);this.rotation=Utils.RadToGrad(Math.atan2(i.y,i.x))}__extends(t,e);t.prototype.update=function(t){e.prototype.update.call(this,t);if(this.liveTime<this.maxTime){this.x+=t*this.speed.x;this.y+=t*this.speed.y}else{this.alpha-=t*3.5;if(this.alpha<=0){this.kill()}}};return t}(GameObject);var AddTimeEffect=function(e){function t(){var t=this;e.call(this);this.container=new createjs.Container;this.addChild(this.container);var n=new DNTextField("p10");this.container.addChild(n);n.scaleX=n.scaleY=.9;var r=AssetsManager.g_instance.getSprite(Constants.IMAGE_GUI_CLOCK);this.container.addChild(r);r.x=-42;r.y=-5;createjs.Tween.get(this.container,{loop:false}).to({y:-100},700,createjs.Ease.backOut).to({alpha:0},400,createjs.Ease.linear).call(function(){return t.kill()})}__extends(t,e);return t}(GameObject);var EndRoundEffect=function(e){function t(){e.call(this);this.stage=0;this.addChild(AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_ROUND_COMPLETED));this.x=350;this.y=400;this.setScale(0);this.alpha=-1}__extends(t,e);t.prototype.update=function(t){e.prototype.update.call(this,t);switch(this.stage){case 0:this.alpha+=t*4;this.setScale(this.scaleX+t*2);if(this.scaleX>1){this.setScale(1);this.alpha=1;this.liveTime=0;this.stage=1;createjs.Tween.get(this,{loop:false}).wait(1400).to({alpha:0},500,createjs.Ease.linear)}break;case 1:this.setScale(1+Math.sin(this.liveTime*5)*.07);break}};t.prototype.setScale=function(e){this.scaleX=this.scaleY=e};return t}(GameObject);var TimeIsUpEffect=function(e){function t(){e.call(this);this.stage=0;this.addChild(AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_TIME_IS_UP));this.x=350;this.y=400;this.setScale(0);this.alpha=-1}__extends(t,e);t.prototype.update=function(t){e.prototype.update.call(this,t);switch(this.stage){case 0:this.alpha+=t*4;this.setScale(this.scaleX+t*2);if(this.scaleX>1){this.setScale(1);this.alpha=1;this.liveTime=0;this.stage=1;createjs.Tween.get(this,{loop:false}).wait(1400).to({alpha:0},500,createjs.Ease.linear)}break;case 1:this.setScale(1+Math.sin(this.liveTime*5)*.07);break}};t.prototype.setScale=function(e){this.scaleX=this.scaleY=e};return t}(GameObject);var MoveHint=function(e){function t(t){e.call(this);this.arrow1=new createjs.Container;this.arrow2=new createjs.Container;this.hidding=false;var n=AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_HINT_ARROW);this.arrow1.addChild(n);this.addChild(this.arrow1);this.arrow1.y-=15;var r=AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_HINT_ARROW);this.arrow2.addChild(r);this.addChild(this.arrow2);this.arrow2.y+=15;this.arrow2.rotation=180;if(t){this.rotation=90}this.alpha=0}__extends(t,e);t.prototype.update=function(t){if(this.liveTime<=.5){this.alpha=this.liveTime*2}e.prototype.update.call(this,t);this.arrow1.x=Math.sin(this.liveTime*7)*5;this.arrow2.x=-this.arrow1.x;if(this.liveTime>20){this.hide()}if(this.hidding){this.alpha-=t*3;if(this.alpha<=0){this.kill()}}};t.prototype.hide=function(){this.hidding=true};return t}(GameObject);var ShowAwesomeEffect=function(e){function t(){e.call(this);this.addChild(AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_AWESOME));this.alpha=0;createjs.Tween.get(this,{loop:false}).to({alpha:1},300,createjs.Ease.linear);this.scaleX=this.scaleY=.5;createjs.Tween.get(this,{loop:false}).to({scaleX:1,scaleY:1},500,createjs.Ease.backOut)}__extends(t,e);t.prototype.update=function(t){e.prototype.update.call(this,t);if(this.liveTime>.7){this.alpha-=t*3;this.scaleX+=t;this.scaleY+=t;if(this.alpha<=0){this.kill()}}};return t}(GameObject);var SuperbEffect=function(e){function t(){e.call(this);this.addChild(AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_SUPERB));this.alpha=0;createjs.Tween.get(this,{loop:false}).to({alpha:1},300,createjs.Ease.linear);this.scaleX=this.scaleY=.5;createjs.Tween.get(this,{loop:false}).to({scaleX:1,scaleY:1},500,createjs.Ease.backOut)}__extends(t,e);t.prototype.update=function(t){e.prototype.update.call(this,t);if(this.liveTime>.7){this.alpha-=t*3;this.scaleX+=t;this.scaleY+=t;if(this.alpha<=0){this.kill()}}};return t}(GameObject);var TutorialHighlighter=function(e){function t(t,n,r,i,s,o){e.call(this);this.topShape=new createjs.Shape;this.bottomShape=new createjs.Shape;this.leftShape=new createjs.Shape;this.rightShape=new createjs.Shape;var u=15;this.leftShape.graphics.beginFill("#000000");this.leftShape.graphics.drawRect(u,s,t-u,o-s);this.leftShape.graphics.endFill();this.addChild(this.leftShape);this.rightShape.graphics.beginFill("#000000");this.rightShape.graphics.drawRect(r,s,Constants.ASSETS_WIDTH-r-u,o-s);this.rightShape.graphics.endFill();this.addChild(this.rightShape);this.topShape.graphics.beginFill("#000000");this.topShape.graphics.drawRect(t,s,r-t,n-s);this.topShape.graphics.endFill();this.addChild(this.topShape);this.bottomShape.graphics.beginFill("#000000");this.bottomShape.graphics.drawRect(t,i,r-t,o-i);this.bottomShape.graphics.endFill();this.addChild(this.bottomShape);this.leftShape.snapToPixel=true;this.rightShape.snapToPixel=true;this.bottomShape.snapToPixel=true;this.topShape.snapToPixel=true;this.alpha=0;createjs.Tween.get(this,{loop:false}).wait(1e3).to({alpha:.6},600,createjs.Ease.linear)}__extends(t,e);t.prototype.magic=function(e){return 0};t.prototype.hide=function(){var e=this;createjs.Tween.get(this,{loop:false}).to({alpha:0},400,createjs.Ease.linear).call(function(){return e.kill()})};return t}(GameObject);var Tutorial=function(e){function t(){e.call(this);this.stage=0;this.text=null;this.stage1Layout=[[1,2,3,4,5,1,2],[2,3,4,5,1,2,3],[5,1,5,3,4,3,4],[2,3,2,1,1,5,5],[4,5,1,2,3,2,1],[1,2,3,4,2,1,2],[3,4,5,1,5,3,4]];this.stage1LayoutAccessible=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];this.stage2LayoutAccessible=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,1,0,0],[0,0,0,0,1,0,0],[0,0,0,0,0,0,0]];this.stage3LayoutAccessible=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]]}__extends(t,e);t.prototype.onStartRound=function(){PlayState.g_instance.spawnDefinedChips(this.stage1Layout);this.onMatch()};t.prototype.onMatch=function(){this.stage++;if(this.highlighter){this.highlighter.hide();this.highlighter=null}if(this.text){this.text.parent.removeChild(this.text);this.text=null}if(this.stage==1){this.highlighter=PlayState.g_instance.highlightArea(2,3,5,5);this.text=new createjs.Text("点击蛋糕并滑动， \n \n 将3个同样的蛋糕连接起来消除它们。","bold 35px Arial","#ffffff");this.text.textAlign="center";this.text.x=Constants.ASSETS_WIDTH/2;this.text.y=300;this.text.alpha=0;PlayState.g_instance.addChild(this.text);createjs.Tween.get(this.text,{loop:false}).wait(1e3).to({alpha:1},600,createjs.Ease.linear)}if(this.stage==2){this.highlighter=PlayState.g_instance.highlightArea(4,4,5,6);this.text=new createjs.Text("连接4或5个蛋糕将会有奖励道具。","bold 35px Arial","#ffffff");this.text.textAlign="center";this.text.x=450;this.text.y=450;this.text.alpha=0;PlayState.g_instance.addChild(this.text);createjs.Tween.get(this.text,{loop:false}).wait(1e3).to({alpha:1},600,createjs.Ease.linear)}if(this.stage==3){this.highlighter=PlayState.g_instance.highlightArea(3,4,5,5);this.text=new createjs.Text("滑动道具将触发效果！","bold 35px Arial","#ffffff");this.text.textAlign="center";this.text.x=Constants.ASSETS_WIDTH/2;this.text.y=450;this.text.alpha=0;PlayState.g_instance.addChild(this.text);createjs.Tween.get(this.text,{loop:false}).wait(1e3).to({alpha:1},600,createjs.Ease.linear)}if(this.stage==4){PlayState.g_instance.stopTutorial()}};t.prototype.setHintIndeces=function(){switch(this.stage){case 1:PlayState.g_instance.setHintIndeces(2,3,2,4);break;case 2:PlayState.g_instance.setHintIndeces(4,4,4,5);break;case 3:PlayState.g_instance.setHintIndeces(3,4,4,4);break}};t.prototype.isAccessibleChip=function(e){if(!this.highlighter){return true}if(this.stage==1){return this.stage1LayoutAccessible[e.getIndexY()][e.getIndexX()]!=0}if(this.stage==2){return this.stage2LayoutAccessible[e.getIndexY()][e.getIndexX()]!=0}if(this.stage==3){return this.stage3LayoutAccessible[e.getIndexY()][e.getIndexX()]!=0}return true};t.prototype.onDead=function(){e.prototype.onDead.call(this);this.highlighter.hide();if(this.text){this.text.parent.removeChild(this.text);this.text=null}};return t}(GameObject);var AcidTutorialState=function(e){function t(){var t=this;e.call(this);this.panel=new createjs.Container;this.hiddingNow=false;this.shader=new createjs.Shape;this.shader.graphics.beginFill("#ead468");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader,{loop:false}).wait(300).to({alpha:.4},800,createjs.Ease.linear);this.addChild(this.panel);this.panel.x=Constants.ASSETS_WIDTH/2;this.panel.y=Constants.SCREEN_HEIGHT*.5;var n=AssetsManager.g_instance.getSprite(Constants.IMAGE_MESSAGE_WINDOW);this.panel.addChild(n);n.x=-575/2;n.y=-493/2;var r=AssetsManager.g_instance.getCenteredSprite("cake_7");this.panel.addChild(r);r.y=-160;var i=new createjs.Text("Poison cant be matched. \nDestroy poison using bonus or \n move poison into the bottom part \nof field. \n [Tutorial text is not ready yet.]","bold 35px Arial","#ffffff");this.panel.addChild(i);i.textAlign="center";i.y=-30;var s=new DNButton(Constants.IMAGE_BUTTON_CLOSE,function(){return t.hide()});this.panel.addChild(s);this.addGuiObject(s);s.x=270;s.y=-210;this.panel.alpha=0;createjs.Tween.get(this.panel,{loop:false}).to({alpha:1},200,createjs.Ease.linear);this.panel.scaleX=.7;this.panel.scaleY=.7;createjs.Tween.get(this.panel,{loop:false}).to({scaleX:1,scaleY:1},400,createjs.Ease.backOut)}__extends(t,e);t.prototype.hide=function(){if(!this.hiddingNow){createjs.Tween.get(this.shader,{loop:false}).to({alpha:0},400,createjs.Ease.linear).call(function(){StateManager.g_instance.popState()});createjs.Tween.get(this.panel,{loop:false}).to({y:-300},300,createjs.Ease.backIn);createjs.Tween.get(this.panel,{loop:false}).to({alpha:0},300,createjs.Ease.linear);this.hiddingNow=true}};return t}(GameState);var AssetsManager=function(e){function t(n){e.call(this);this.myGUI=new Array;this.loadingShape=new createjs.Shape;this.loadingShapeBack1=new createjs.Shape;this.loadingShapeBack2=new createjs.Shape;this.shader=new createjs.Shape;this.maxWidth=100;this.deltaY=50;this.myLogo=null;this.moregames=null;t.g_instance=this;document.getElementById("loader").className="loader";createjs.EventDispatcher.initialize(t.prototype);this.manifest=n;this.labelPercentDownload=new createjs.Text("Loading: 100%","bold 45px Arial","#ffffff");this.labelPercentDownload.textAlign="center";this.addChild(this.labelPercentDownload);this.maxWidth=this.labelPercentDownload.getBounds().width;this.deltaY=this.labelPercentDownload.getBounds().height;this.loadingShapeBack1.graphics.beginFill("#4a7dc2");this.loadingShapeBack1.graphics.drawRect(0-4,0-4,this.maxWidth+8,this.deltaY+8);this.loadingShapeBack1.graphics.endFill();this.addChild(this.loadingShapeBack1);this.loadingShape.graphics.beginFill("#ffffff");this.loadingShape.graphics.drawRect(0,0,this.maxWidth,this.deltaY);this.loadingShape.graphics.endFill();this.addChild(this.loadingShape);this.loadingShape.scaleX=0;this.shader=new createjs.Shape;this.shader.graphics.beginFill("#4aa4c2");this.shader.graphics.drawRect(0,0,this.maxWidth*1.2,130);this.shader.graphics.endFill();this.addChildAt(this.shader,0);this.onOrientationChanged(StateManager.g_instance.isLandscape())}__extends(t,e);t.prototype.startDownLoad=function(){var e=this;this.loader=new createjs.LoadQueue;this.loader.addEventListener("progress",function(t){return e.handleProgress(t)});this.loader.addEventListener("complete",function(t){return e.handleComplete(t)});createjs.Sound.registerManifest(this.manifest,"assets/sound/");if(createjs.Sound.alternateExtensions){createjs.Sound.alternateExtensions=["mp3"]}this.loader.installPlugin(createjs.SoundJS);this.loader.loadManifest(this.manifest)};t.prototype.handleProgress=function(e){this.labelPercentDownload.text="拼命加载中: "+(e.loaded*100).toFixed(1)+"%";this.loadingShape.scaleX=e.loaded;if(!this.myLogo){var t=this.getBitmap(Constants.IMAGE_ZIBBO_LOGO);if(t&&t.getBounds()){this.myLogo=new DNSpilLogo(Constants.IMAGE_ZIBBO_LOGO,false);this.myGUI.push(this.myLogo);this.addChild(this.myLogo);this.myLogo.scaleX=this.myLogo.scaleY=.85;this.arrangeShit()}}if(!this.moregames){var t=this.getBitmap(Constants.IMAGE_MOREGAMES_LOGO);if(t&&t.getBounds()){this.moregames=new DNSpilLogo(Constants.IMAGE_MOREGAMES_LOGO,true);this.myGUI.push(this.moregames);this.addChild(this.moregames);this.moregames.scaleX=this.moregames.scaleY=.85;this.arrangeShit()}}};t.prototype.arrangeShit=function(){if(this.moregames){this.moregames.x=Constants.ASSETS_WIDTH/2+140;this.moregames.y=this.labelPercentDownload.y+180}if(this.myLogo){this.myLogo.x=Constants.ASSETS_WIDTH/2-140;this.myLogo.y=this.labelPercentDownload.y+180}};t.prototype.onMouseDown=function(e,t){for(var n=0;n<this.myGUI.length;n++){this.myGUI[n].onMouseDown(e,t)}};t.prototype.onMouseMove=function(e,t){for(var n=0;n<this.myGUI.length;n++){this.myGUI[n].onMouseMove(e,t)}};t.prototype.onMouseUp=function(e,t){for(var n=0;n<this.myGUI.length;n++){this.myGUI[n].onMouseUp(e,t)}};t.prototype.handleComplete=function(e){this.removeChild(this.labelPercentDownload);this.mainMenuSprites=new createjs.SpriteSheet({images:[this.getBitmap("main_menu").image],frames:[[2,2,624,332],[799,291,163,135],[628,291,169,171],[628,2,324,287],[2,336,106,99]],animations:{title:[0],title_blue_cake:[1],title_pink_cake:[2],title_red_cake:[3],title_salad_cake:[4]}});this.gameplaySprites=new createjs.SpriteSheet({images:[this.getBitmap("art").image],frames:[[969,404,27,38],[717,549,27,38],[717,509,27,38],[984,82,28,38],[530,537,27,38],[530,497,27,38],[717,469,27,38],[984,42,28,38],[993,2,29,38],[969,484,26,38],[579,277,189,40],[2,560,111,111],[343,560,131,132],[832,540,131,133],[833,404,134,134],[837,216,185,186],[210,560,131,132],[2,809,131,132],[2,675,131,132],[574,607,90,87],[746,472,84,88],[753,381,78,89],[476,667,86,91],[666,651,86,83],[746,562,84,87],[135,672,69,97],[753,345,79,34],[2,980,106,35],[2,943,111,35],[115,577,93,93],[819,277,16,38],[476,577,96,88],[837,181,71,30],[579,38,403,78],[770,302,41,41],[770,277,47,23],[930,122,92,92],[2,2,575,493],[969,444,26,38],[579,181,256,94],[579,2,412,34],[2,497,526,61],[579,469,136,136],[579,319,172,106],[579,427,156,40],[579,118,349,61]],animations:{0:[0],1:[1],2:[2],3:[3],4:[4],5:[5],6:[6],7:[7],8:[8],9:[9],awesome:[10],button_close:[11],button_credits:[12],button_exit:[13],button_pause:[14],button_play:[15],button_restart:[16],button_sound_off:[17],button_sound_on:[18],cake_1:[19],cake_2:[20],cake_3:[21],cake_4:[22],cake_5:[23],cake_6:[24],cake_7:[25],caption_goal:[26],caption_round:[27],caption_scores:[28],clock_cake:[29],d:[30],donut:[31],drop:[32],gameover_caption:[33],gui_clock:[34],hint_arrow:[35],lolipop:[36],message_window:[37],p:[38],pause_caption:[39],progress_bar:[40],round_completed:[41],shining:[42],sickle:[43],superb:[44],time_is_up:[45]}});this.dispatchEvent(Constants.LOAD_COMPLETE,this);document.getElementById("loader").className=""};t.prototype.getResult=function(e){return this.loader.getResult(e)};t.prototype.getBitmap=function(e){return new createjs.Bitmap(this.loader.getResult(e))};t.prototype.getCenteredBitmap=function(e){var t=new createjs.Bitmap(this.loader.getResult(e));if(!t.image){console.log("ERROR HERE",e)}t.x=-t.image.width/2;t.y=-t.image.height/2;return t};t.prototype.getSprite=function(e){var t=new createjs.Sprite(this.gameplaySprites,e);t.stop();return t};t.prototype.getCenteredSprite=function(e){var t=this.getSprite(e);t.x=-t.getBounds().width/2;t.y=-t.getBounds().height/2;return t};t.prototype.getMainMenuSprite=function(e){var t=new createjs.Sprite(this.mainMenuSprites,e);t.stop();return t};t.prototype.getMainMenuCenteredSprite=function(e){var t=this.getMainMenuSprite(e);t.x=-t.getBounds().width/2;t.y=-t.getBounds().height/2;return t};t.prototype.onOrientationChanged=function(e){this.labelPercentDownload.x=Constants.ASSETS_WIDTH/2;this.labelPercentDownload.y=Constants.ASSETS_HEIGHT/2;this.loadingShape.x=this.labelPercentDownload.x-this.maxWidth/2;this.loadingShape.y=this.labelPercentDownload.y+this.deltaY*1.5;this.loadingShapeBack1.x=this.loadingShape.x;this.loadingShapeBack1.y=this.loadingShape.y;this.shader.x=this.labelPercentDownload.x-this.maxWidth*.6;this.shader.y=this.labelPercentDownload.y;this.arrangeShit()};return t}(GameState);var DNSpilLogo=function(e){function t(t,n){var r=this;e.call(this,t,function(){return r.goSpil()},true);this.picWidth=this.picture.getBounds().width;this.picHeight=this.picture.getBounds().height;this.moreGames=n}__extends(t,e);t.prototype.goSpil=function(){try{if(this.moreGames){Play68.goHome()}else{Play68.goHome()}}catch(e){console.log(e)}};t.prototype.select=function(){if(!this.selected){this.selected=true}};t.prototype.deselect=function(){if(this.selected){this.selected=false}};return t}(DNButton);var PauseState=function(e){function t(){var t=this;e.call(this);this.panel=new createjs.Container;this.hiddingNow=false;this.shader=new createjs.Shape;this.shader.graphics.beginFill("#ead468");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader,{loop:false}).wait(300).to({alpha:.4},800,createjs.Ease.linear);this.addChild(this.panel);this.panel.x=Constants.ASSETS_WIDTH/2;this.panel.y=Constants.SCREEN_HEIGHT*.5;var n=AssetsManager.g_instance.getCenteredSprite(Constants.IMAGE_MESSAGE_WINDOW);this.panel.addChild(n);var r=new DNButton(Constants.IMAGE_BUTTON_CLOSE,function(){return t.hide()});this.panel.addChild(r);this.addGuiObject(r);r.x=270;r.y=-210;var i=new DNButton(Constants.IMAGE_BUTTON_PLAY,function(){return t.hide()});this.panel.addChild(i);this.addGuiObject(i);i.x=0;i.y=-90;var s=new DNButton(Constants.IMAGE_BUTTON_RESTART,function(){return t.onRestartTouch()});this.panel.addChild(s);this.addGuiObject(s);s.x=-190;s.y=130;var o=new DNButton(Constants.IMAGE_BUTTON_EXIT,function(){return t.onExitTouch()});this.panel.addChild(o);this.addGuiObject(o);o.x=0;o.y=130;this.setSoundButton();var u=AssetsManager.g_instance.getSprite(Constants.IMAGE_PAUSE_CAPTION);this.panel.addChild(u);u.x=-128;u.y=-300;this.panel.alpha=0;createjs.Tween.get(this.panel,{loop:false}).to({alpha:1},200,createjs.Ease.linear);this.panel.scaleX=.7;this.panel.scaleY=.7;createjs.Tween.get(this.panel,{loop:false}).to({scaleX:1,scaleY:1},400,createjs.Ease.backOut);this.showMoreGames(this.panel)}__extends(t,e);t.prototype.setSoundButton=function(){var e=this;if(this.soundButton&&this.soundButton.parent){this.soundButton.parent.removeChild(this.soundButton)}var t=SoundManager.g_instance.isSoundEnabled();this.soundButton=new DNButton(t?Constants.IMAGE_BUTTON_SOUND_ON:Constants.IMAGE_BUTTON_SOUND_OFF,function(){return e.onSoundTouch()});this.panel.addChild(this.soundButton);this.addGuiObject(this.soundButton);this.soundButton.x=+190;this.soundButton.y=130};t.prototype.hide=function(){if(!this.hiddingNow){createjs.Tween.get(this.shader,{loop:false}).to({alpha:0},400,createjs.Ease.linear).call(function(){StateManager.g_instance.popState()});createjs.Tween.get(this.panel,{loop:false}).to({y:-300},300,createjs.Ease.backIn);createjs.Tween.get(this.panel,{loop:false}).to({alpha:0},300,createjs.Ease.linear);this.hiddingNow=true;this.hideMoreGames()}};t.prototype.update=function(t){e.prototype.update.call(this,t)};t.prototype.onRestartTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new PlayState))};t.prototype.onExitTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new MainMenuState))};t.prototype.onSoundTouch=function(){SoundManager.g_instance.setSoundEnabled(!SoundManager.g_instance.isSoundEnabled());this.setSoundButton()};return t}(GameState);var PlayState=function(e){function t(){var n=this;e.call(this);this.INPUT_STATE_WAIT_LOSE="INPUT_STATE_WAIT_LOSE";this.INPUT_STATE_WAIT_SELECTION="INPUT_STATE_WAIT_SELECTION";this.INPUT_STATE_LOCK="INPUT_STATE_LOCK";this.INPUT_STATE_WAIT_SPAWN="INPUT_STATE_WAIT_SPAWN";this.INPUT_STATE_SHIFT="INPUT_STATE_SHIFT";this.INPUT_STATE_MATCHING="INPUT_STATE_MATCHING";this.INPUT_STATE_SCISSORS="INPUT_STATE_SCISSORS";this.INPUT_STATE_WAIT_NEXT_ROUND="INPUT_STATE_WAIT_NEXT_ROUND";this.matchInARow=0;this.inputState=null;this.fieldWidth=7;this.fieldHeight=7;this.selectedChip=null;this.swapChip1=null;this.swapChip2=null;this.lastMovedChip=null;this.underChipsLayer=new createjs.Container;this.backChipsLayer=new createjs.Container;this.frontChipsLayer=new createjs.Container;this.inputStateTime=0;this.spawnClockProb=.05;this.tutorial=null;this.timeLeftTotal=0;this.timeLeft=0;this.timerPaused=false;this.acidProbs=[0,0,0,0,0,0,.1,.1,.15,.2,.23,.25];this.score=0;this.tmpScore=0;this.scoreLabel=new DNTextField("000000");this.scoreGoalBefore=0;this.scoreGoal=0;this.scoreGoalLabel=new DNTextField("");this.roundLabel=new DNTextField("");this.round=-1;this.chipTypesCount=5;this.acidProb=1;this.firstAcidRound=7;this.awesomeEffectTime=0;this.superbEffectTime=0;this.wasFirstAcid=false;this.lastDropSoundTime=-10;this.lastDropID=-1;this.spawnCounter=0;this.spawnIDS=[3,2,1,1,5,1,5,2,4,3,2,3,4,4];var r=AssetsManager.g_instance.getBitmap(Constants.IMAGE_BACK);this.addChild(r);var i=new DNButton(Constants.IMAGE_BUTTON_PAUSE,function(){return n.onPauseClick()});this.addChild(i);i.x=85;i.y=112;this.addGuiObject(i);var s=new DNSpilLogo(Constants.IMAGE_ZIBBO_LOGO,false);this.addChild(s);s.x=485;s.y=70;this.addGuiObject(s);s.scaleX=s.scaleY=.5;this.addChild(this.roundLabel);this.roundLabel.x=120;this.roundLabel.y=164;this.scoreProgressBar=AssetsManager.g_instance.getSprite(Constants.IMAGE_PROGRESS_BAR);this.addChild(this.scoreProgressBar);this.scoreProgressBar.x=271;this.scoreProgressBar.y=91;this.scoreLeftShape=new createjs.Shape;this.scoreLeftShape.graphics.beginFill("#000000");this.scoreLeftShape.graphics.drawRect(0,0,this.scoreProgressBar.getBounds().width,this.scoreProgressBar.getBounds().height);this.scoreLeftShape.graphics.endFill();this.scoreLeftShape.x=this.scoreProgressBar.x;this.scoreLeftShape.y=this.scoreProgressBar.y;this.scoreProgressBar.mask=this.scoreLeftShape;this.addChild(this.scoreLabel);this.scoreLabel.x=285;this.scoreLabel.y=92;this.scoreLabel.scaleX=this.scoreLabel.scaleY=.85;this.addChild(this.scoreGoalLabel);this.scoreGoalLabel.x=550;this.scoreGoalLabel.y=92;this.scoreGoalLabel.scaleX=this.scoreGoalLabel.scaleY=.85;this.timeProgressBar=AssetsManager.g_instance.getSprite(Constants.IMAGE_PROGRESS_BAR);this.addChild(this.timeProgressBar);this.timeProgressBar.x=271;this.timeProgressBar.y=164;this.timeLeftShape=new createjs.Shape;this.timeLeftShape.graphics.beginFill("#000000");this.timeLeftShape.graphics.drawRect(0,0,this.timeProgressBar.getBounds().width,this.timeProgressBar.getBounds().height);this.timeLeftShape.graphics.endFill();this.timeLeftShape.x=this.timeProgressBar.x;this.timeLeftShape.y=this.timeProgressBar.y;this.timeProgressBar.mask=this.timeLeftShape;this.timeLeftLabel=new DNTextField("");this.addChild(this.timeLeftLabel);this.timeLeftLabel.x=425;this.timeLeftLabel.y=165;this.timeLeftLabel.scaleX=this.timeLeftLabel.scaleY=.9;var o=AssetsManager.g_instance.getSprite(Constants.IMAGE_GUI_CLOCK);this.addChild(o);o.x=393;o.y=128;t.g_instance=this;this.field=new Array(this.fieldWidth);for(var u=0;u<this.fieldWidth;u++){this.field[u]=new Array(this.fieldHeight)}this.addChild(this.underChipsLayer);this.addChild(this.backChipsLayer);this.addChild(this.frontChipsLayer);this.configureYAlign();this.startNextRound()}__extends(t,e);t.prototype.onPauseClick=function(){StateManager.g_instance.pushState(new PauseState)};t.prototype.onSpilPause=function(){StateManager.g_instance.pushState(new PauseState)};t.prototype.createChip=function(e,t,n){var r=Utils.RandomRangeInt(1,this.chipTypesCount);if(this.chipTypesCount==7){if(Math.random()<this.acidProb){r=Utils.RandomRangeInt(1,this.chipTypesCount)}else{r=Utils.RandomRangeInt(1,this.chipTypesCount-1)}}if(!this.wasFirstAcid&&this.round==this.firstAcidRound){this.wasFirstAcid=true;r=7}var i=new Chip(r,e,t,this.getYPosByYIndex(t),n);i.setIncexes(e,t);this.addGameObjectAtPos(i,this.backChipsLayer,this.getXPosByXIndex(e),-Constants.CELL_SIZE);this.field[e][t]=i};t.prototype.createChipWithColorID=function(e,t,n,r){var i=new Chip(r,e,t,this.getYPosByYIndex(t),n);i.setIncexes(e,t);this.addGameObjectAtPos(i,this.backChipsLayer,this.getXPosByXIndex(e),-Constants.CELL_SIZE);this.field[e][t]=i};t.prototype.getXPosByXIndex=function(e){return e*Constants.CELL_SIZE+Constants.CELL_SIZE/2+Constants.FIELD_OFFSET_X};t.prototype.getYPosByYIndex=function(e){return e*Constants.CELL_SIZE+Constants.CELL_SIZE/2+Constants.FIELD_OFFSET_Y};t.prototype.update=function(t){e.prototype.update.call(this,t);this.inputStateTime+=t;if(this.inputState!=this.INPUT_STATE_WAIT_SELECTION){if(this.moveHint){if(this.moveHint.isDead()){this.moveHint=null}else{this.moveHint.hide()}}}switch(this.inputState){case this.INPUT_STATE_WAIT_SELECTION:var n=this.tutorial!=null?.3:3;if(this.inputStateTime>n&&!this.moveHint.parent){this.addGameObjectAt(this.moveHint,this)}if(this.timeLeft<=0){this.lose()}break;case this.INPUT_STATE_WAIT_SPAWN:if(this.allChipsNormal()){this.matchMatches(this.findMatches())}break;case this.INPUT_STATE_SHIFT:if(this.allChipsNormal()){this.matchMatches(this.findMatches())}break;case this.INPUT_STATE_MATCHING:if(this.inputStateTime>Constants.MATCH_TIME/2){this.checkEmptyCells();this.shiftChips()}break;case this.INPUT_STATE_WAIT_NEXT_ROUND:if(this.inputStateTime>3){this.startNextRound()}break;case this.INPUT_STATE_WAIT_LOSE:if(this.inputStateTime>2.4){StateManager.g_instance.pushState(new GameOverState(this.round+1,this.score,this.scoreGoal))}break}if(this.tmpScore<this.score){this.tmpScore+=17;if(this.tmpScore>this.score){this.tmpScore=this.score}var r=this.tmpScore.toString();switch(r.length){case 1:r="00000"+r;break;case 2:r="0000"+r;break;case 3:r="000"+r;break;case 4:r="00"+r;break;case 5:r="0"+r;break;case 6:break}this.scoreLabel.setText(r)}if(!this.timerPaused&&!this.tutorial){this.timeLeft-=t;if(this.timeLeft<4){this.timeLeftLabel.visible=this.timeLeft%.5<.25}else{this.timeLeftLabel.visible=true}if(this.timeLeft<=0){this.timeLeft=0}var i=this.timeLeft/this.timeLeftTotal;if(i>1){i=1}this.timeLeftShape.x=this.timeProgressBar.x-(1-i)*this.timeProgressBar.getBounds().width;this.timeLeftLabel.setText(Utils.IntToTimeString(Math.floor(this.timeLeft)))}};t.prototype.allChipsNormal=function(){for(var e=0;e<this.fieldWidth;e++){for(var t=0;t<this.fieldHeight;t++){if(this.field[e][t]!=null&&!this.field[e][t].isNormal()){return false}}}return true};t.prototype.needSpawn=function(){for(var e=0;e<this.fieldWidth;e++){for(var t=0;t<this.fieldHeight;t++){if(this.field[e][t]==null){return true}}}return false};t.prototype.canExchange=function(e,t){if(e==t){return false}var n=e.getIndeces().x-t.getIndeces().x;var r=e.getIndeces().y-t.getIndeces().y;return Math.abs(n)==1&&r==0||Math.abs(r)==1&&n==0};t.prototype.exchangeChips=function(e,t){var n=this;var r=e.x;var i=e.y;var s=e.getIndexX();var o=e.getIndexY();var u=t.x;var a=t.y;var f=t.getIndexX();var l=t.getIndexY();this.field[s][o]=t;this.field[f][l]=e;e.exchange(f,l);t.exchange(s,o);this.swapChip1=e;this.swapChip2=t;createjs.Tween.get(e,{loop:false}).to({x:u,y:a},Constants.EXCHANGE_TIME*1e3,createjs.Ease.linear).call(function(){return n.onExchangeEnded()});createjs.Tween.get(t,{loop:false}).to({x:r,y:i},Constants.EXCHANGE_TIME*1e3,createjs.Ease.linear);this.selectedChip=null;this.setInpunState(this.INPUT_STATE_LOCK)};t.prototype.addConverToBonusEffect=function(e){var t=new ConvertToBonusEffect(e);this.addGameObjectAtPos(t,this.underChipsLayer,e.x,e.y-Constants.CELL_SIZE/2)};t.prototype.matchMatches=function(e){if(e.length!=0){if(this.tutorial){this.tutorial.onMatch()}if(e[0][0].isAcid()){}else{switch(Utils.RandomRangeInt(0,3)){case 0:SoundManager.g_instance.play(SoundManager.SOUND_MATCH_1);break;case 1:SoundManager.g_instance.play(SoundManager.SOUND_MATCH_2);break;case 2:SoundManager.g_instance.play(SoundManager.SOUND_MATCH_3);break;case 3:SoundManager.g_instance.play(SoundManager.SOUND_MATCH_4);break}}var t=false;for(var n=0;n<e.length;n++){for(var r=0;r<e[n].length;r++){e[n][r].match(Chip.MATCH_REASON_SIMPLE)}if(e[n].length==4){var i=false;for(var s=0;s<e[n].length;s++){if(e[n][s]==this.lastMovedChip){i=true;t=true;this.lastMovedChip.convertToBonus(Chip.BONUS_4);this.lastMovedChip=null;break}}if(!i){t=true;e[n][Utils.RandomRangeInt(1,2)].convertToBonus(Chip.BONUS_4)}}if(e[n].length>=5){var i=false;for(var s=0;s<e[n].length;s++){if(e[n][s]==this.lastMovedChip){t=true;i=true;this.lastMovedChip.convertToBonus(Chip.BONUS_5);this.lastMovedChip=null;break}}if(!i){t=true;e[n][Utils.RandomRangeInt(1,e[n].length-2)].convertToBonus(Chip.BONUS_5)}}}if(!t){for(var n=0;n<e.length;n++){for(var r=0;r<e[n].length;r++){if(e[n][r].isDoubleMatched()){e[n][r].convertToBonus(Chip.BONUS_CLOCK);n=100;break}}}}this.setInpunState(this.INPUT_STATE_MATCHING)}else{this.shiftChips()}};t.prototype.matchBonus=function(e,t){if(this.tutorial){this.stopTutorial()}if(e.getBonusType()==Chip.BONUS_4){SoundManager.g_instance.play(SoundManager.SOUND_LINE);var n=e.getIndexY()==t.getIndexY();if(n){var r=e.getIndexY();for(var i=0;i<this.fieldWidth;i++){if(this.field[i][r]!=null){this.field[i][r].match(Chip.MATCH_REASON_BONUS_EFFECT_4_HOR)}}this.addGameObjectAtPos(new KillLineEffect(new createjs.Point(+1200,0)),this,e.x,e.y-Constants.CELL_SIZE/2);this.addGameObjectAtPos(new KillLineEffect(new createjs.Point(-1200,0)),this,e.x,e.y-Constants.CELL_SIZE/2)}else{var s=e.getIndexX();for(var i=0;i<this.fieldHeight;i++){if(this.field[s][i]!=null){this.field[s][i].match(Chip.MATCH_REASON_BONUS_EFFECT_4_VERT)}}this.addGameObjectAtPos(new KillLineEffect(new createjs.Point(0,-1200)),this,e.x,e.y-Constants.CELL_SIZE/2);this.addGameObjectAtPos(new KillLineEffect(new createjs.Point(0,+1200)),this,e.x,e.y-Constants.CELL_SIZE/2)}}if(e.getBonusType()==Chip.BONUS_5){SoundManager.g_instance.play(SoundManager.SOUND_KILL_COLOR);e.match(Chip.MATCH_REASON_I_AM_BONUS);var o=new createjs.Point(e.x,e.y);var u=t.getColorID();for(var a=0;a<this.fieldWidth;a++){for(var f=0;f<this.fieldHeight;f++){if(this.field[a][f]!=null){if(this.field[a][f].getColorID()==u){var l=new createjs.Point(this.field[a][f].x,this.field[a][f].y-Constants.CELL_SIZE/2);this.addGameObjectAtPos(new KillColorEffect(o,l),this,o.x,o.y);this.field[a][f].match(Chip.MATCH_REASON_BONUS_EFFECT_5)}}}}}if(e.getBonusType()==Chip.BONUS_CLOCK){e.match(Chip.MATCH_REASON_I_AM_BONUS);t.match(Chip.MATCH_REASON_EXCHANGE_WIHT_BONUS)}this.setInpunState(this.INPUT_STATE_MATCHING)};t.prototype.onExchangeEnded=function(){if(this.inputState==this.INPUT_STATE_WAIT_LOSE){return}var e=this.swapChip1!=null||this.swapChip2!=null;var t=false;if(e){if(this.swapChip1.isBonus()){t=true}if(this.swapChip2.isBonus()){t=true}}var n=this.findMatches();if(n.length==0){if(!t){if(e){this.exchangeChips(this.swapChip1,this.swapChip2);this.swapChip1=null;this.swapChip2=null}else{this.setInpunState(this.INPUT_STATE_WAIT_SELECTION)}}}else{this.matchMatches(n)}if(e&&t){if(this.swapChip1.isBonus()){this.matchBonus(this.swapChip1,this.swapChip2)}if(this.swapChip2.isBonus()){this.matchBonus(this.swapChip2,this.swapChip1)}}};t.prototype.findMatches=function(){var e=Array();for(var t=0;t<this.fieldHeight;t++){for(var n=0;n<this.fieldWidth;){var r=-1;var i=0;var s=new Array;for(var o=n;o<this.fieldWidth;o++){if(this.field[o][t]==null||this.field[o][t].isBonus()||this.field[o][t].getColorID()==-1){break}else{if(r==-1){r=this.field[o][t].getColorID()}}if(this.field[o][t].getColorID()==r){s.push(this.field[o][t]);i++}else{break}}if(i>=3){e.push(s)}if(i!=0){n+=i}else{n++}}}for(var n=0;n<this.fieldWidth;n++){for(var t=0;t<this.fieldHeight;t){var r=-1;var i=0;var s=new Array;for(var o=t;o<this.fieldHeight;o++){if(this.field[n][o]==null||this.field[n][o].isBonus()||this.field[n][o].getColorID()==-1){break}else{if(r==-1){r=this.field[n][o].getColorID()}}if(this.field[n][o].getColorID()==r){s.push(this.field[n][o]);i++}else{break}}if(i>=3){e.push(s)}if(i!=0){t+=i}else{t++}}}var u=new Array;var a=this.fieldHeight-1;for(var n=0;n<this.fieldWidth;n++){if(this.field[n][a]!=null&&this.field[n][a].isAcid()){u.push(this.field[n][a])}}if(u.length!=0){e.push(u)}return e};t.prototype.onMouseUp=function(t,n){e.prototype.onMouseUp.call(this,t,n);this.selectedChip=null};t.prototype.onMouseDown=function(t,n){e.prototype.onMouseDown.call(this,t,n);n-=this.y;if(this.inputState!=this.INPUT_STATE_WAIT_SELECTION){return}var r=this.checkChipSelection(t,n);if(r){if(this.tutorial&&!this.tutorial.isAccessibleChip(r)){return}if(r==this.selectedChip){return}if(!this.selectedChip){this.selectedChip=r;this.selectedChip.select()}else{if(this.canExchange(this.selectedChip,r)){this.lastMovedChip=this.selectedChip;this.exchangeChips(this.selectedChip,r)}else{this.selectedChip.deselect();this.selectedChip=r;this.selectedChip.select()}}}this.checkEmptyCells()};t.prototype.onMouseMove=function(t,n){e.prototype.onMouseMove.call(this,t,n);if(this.inputState!=this.INPUT_STATE_WAIT_SELECTION){return}this.onMouseDown(t,n)};t.prototype.checkEmptyCells=function(){for(var e=0;e<this.fieldWidth;e++){for(var t=0;t<this.fieldHeight;t++){var n=this.field[e][t];if(n){if(n.isOutOfField()){this.frontChipsLayer.addChild(n);this.field[e][t]=null}}}}};t.prototype.shiftChips=function(){this.matchInARow++;var e=false;for(var t=0;t<this.fieldWidth;t++){var n=0;for(var r=this.fieldHeight-1;r>=0;r--){if(this.field[t][r]==null){n++}else{if(n!=0){e=true;var i=r+n;this.field[t][r].shiftDown(i,this.getYPosByYIndex(i));this.field[t][i]=this.field[t][r];this.field[t][r]=null}}}}if(e){this.setInpunState(this.INPUT_STATE_SHIFT)}else{this.spawnNewChips()}};t.prototype.spawnDefinedChips=function(e){var t=0;for(var n=0;n<this.fieldWidth;n++){var r=-1;for(var i=this.fieldHeight-1;i>=0;i--){if(this.field[n][i]==null){if(r==-1){r=i}t++;this.createChipWithColorID(n,i,(r-i)*.13,e[i][n])}}}if(t>0){this.setInpunState(this.INPUT_STATE_WAIT_SPAWN)}else{this.setInpunState(this.INPUT_STATE_WAIT_SELECTION)}};t.prototype.spawnNewChips=function(){var e=0;for(var t=0;t<this.fieldWidth;t++){var n=-1;for(var r=this.fieldHeight-1;r>=0;r--){if(this.field[t][r]==null){if(n==-1){n=r}e++;if(this.tutorial){this.createChipWithColorID(t,r,(n-r)*.13,this.getTutorialSpawnNewID())}else{this.createChip(t,r,(n-r)*.13)}}}}if(e>0){this.setInpunState(this.INPUT_STATE_WAIT_SPAWN)}else{this.setInpunState(this.INPUT_STATE_WAIT_SELECTION)}};t.prototype.checkChipSelection=function(e,t){for(var n=0;n<this.fieldWidth;n++){for(var r=0;r<this.fieldHeight;r++){var i=this.field[n][r];if(i){if(Math.abs(i.x-e)<Constants.CELL_SIZE/2&&i.y>t&&i.y<t+Constants.CELL_SIZE){return i}}}}return null};t.prototype.setInpunState=function(e){this.inputState=e;this.inputStateTime=0;var n=window.devicePixelRatio?window.devicePixelRatio:1;var r=window.innerWidth*n;var i=window.innerHeight*n;if(this.inputState==this.INPUT_STATE_WAIT_SELECTION){this.matchInARow=0;if(this.findMoves()){var s=this.field[this.findedMatchPos1.x][this.findedMatchPos1.y];var o=this.field[this.findedMatchPos2.x][this.findedMatchPos2.y];this.moveHint=new MoveHint(this.findedMatchPos1.y!=this.findedMatchPos2.y);this.moveHint.x=(s.x+o.x)/2;this.moveHint.y=(s.y+o.y)/2-Constants.CELL_SIZE/2}else{this.field[Utils.RandomRangeInt(0,this.fieldWidth-1)][Utils.RandomRangeInt(0,this.fieldHeight-1)].convertToBonus([Chip.BONUS_CLOCK,Chip.BONUS_4,Chip.BONUS_5][Utils.RandomRangeInt(0,2)])}if(this.round==this.firstAcidRound&&t.needShowAcidTutorial){t.needShowAcidTutorial=false;StateManager.g_instance.pushState(new AcidTutorialState)}}};t.prototype.clearCell=function(e){var t=e.getIndexX();var n=e.getIndexY();if(this.field[t][n]==e){this.field[t][n]=null}};t.prototype.startNextRound=function(){this.round++;this.scoreGoalBefore=this.scoreGoal;if(this.round<t.scoreGoalsByRound.length){this.scoreGoal=t.scoreGoalsByRound[this.round]}else{var e=t.scoreGoalsByRound[t.scoreGoalsByRound.length-1];this.scoreGoal=e+(this.round-t.scoreGoalsByRound.length+1)*7e3}this.updateScoreProgressBar();if(this.round<t.timeLeftByRound.length){this.timeLeft=t.timeLeftByRound[this.round]}else{this.timeLeft=60}this.timeLeftTotal=this.timeLeft;this.timeLeftLabel.setText(Utils.IntToTimeString(Math.floor(this.timeLeft)));if(this.round>=4){this.chipTypesCount=6}if(this.round>=this.firstAcidRound){this.chipTypesCount=7}if(this.round<this.acidProbs.length){this.acidProb=this.acidProbs[this.round]}else{this.acidProb=.25}this.timerPaused=false;this.matchInARow=0;this.scoreGoalLabel.setText(this.scoreGoal.toString());this.roundLabel.setText((this.round+1).toString());myPlayGameLevel=this.round+1;myPlayGameScore=this.scoreGoal;if(t.needShowTutorial){this.tutorial=new Tutorial;this.addGameObjectAt(this.tutorial,this);this.tutorial.onStartRound()}else{this.spawnNewChips()}if(this.round>0){try{GameAPI.GameBreak.request(function(){StateManager.g_instance.onSpilPause()},function(){StateManager.g_instance.onSpilResume()})}catch(n){console.log("GameAPI.GameBreak.request error")}}};t.prototype.highlightArea=function(e,t,n,r){var i=this.getXPosByXIndex(e)-Constants.CELL_SIZE/2;var s=this.getYPosByYIndex(t)-Constants.CELL_SIZE;var o=this.getXPosByXIndex(n)-Constants.CELL_SIZE/2;var u=this.getYPosByYIndex(r)-Constants.CELL_SIZE;var a=new TutorialHighlighter(i,s,o,u,this.getYPosByYIndex(0)-Constants.CELL_SIZE,this.getYPosByYIndex(7)-Constants.CELL_SIZE);this.addGameObjectAt(a,this);return a};t.prototype.finishRound=function(){this.addGameObjectAt(new EndRoundEffect,this);this.timerPaused=true;this.setInpunState(this.INPUT_STATE_WAIT_NEXT_ROUND);for(var e=0;e<this.fieldWidth;e++){for(var t=0;t<this.fieldHeight;t++){if(this.field[e][t]!=null&&this.field[e][t].isNormal()){this.field[e][t].fallDown()}}}};t.prototype.lose=function(){this.addGameObjectAt(new TimeIsUpEffect,this);SoundManager.g_instance.play(SoundManager.SOUND_ALARM);this.setInpunState(this.INPUT_STATE_WAIT_LOSE);this.timerPaused=true};t.prototype.haveMoves=function(){for(var e=0;e<this.fieldWidth;e++){for(var t=0;t<this.fieldHeight;t++){if(this.field[e][t]!=null&&this.field[e][t].isBonus()){return true}}}return true};t.prototype.updateScoreProgressBar=function(){var e=(this.score-this.scoreGoalBefore)/(this.scoreGoal-this.scoreGoalBefore);if(e>1){e=1}this.scoreLeftShape.x=this.scoreProgressBar.x-(1-e)*this.scoreProgressBar.getBounds().width};t.prototype.addPointsAt=function(e,t){if(e.getBonusType()==null){var n=40;switch(t){case Chip.MATCH_REASON_EXCHANGE_WIHT_BONUS:n=40;break;case Chip.MATCH_REASON_BONUS_EFFECT_5:n=100;break;case Chip.MATCH_REASON_BONUS_EFFECT_4_HOR:n=90;break;case Chip.MATCH_REASON_BONUS_EFFECT_4_VERT:n=120;break;case Chip.MATCH_REASON_I_AM_BONUS:n=150;break;default:n=40+this.matchInARow*20;break}if(e.isAcid()){n=200}var r=new FlyingPoints(n);this.score+=n;var i=e.x-Constants.CELL_SIZE/2;var s=e.y-Constants.CELL_SIZE/2;this.tryShowAwesome(i,s);this.tryShowSuperb(i,s);this.addGameObjectAtPos(r,this,i,s);this.updateScoreProgressBar()}else{if(e.getBonusType()==Chip.BONUS_CLOCK){this.timeLeft+=10;SoundManager.g_instance.play(SoundManager.SOUND_ADD_TIME);this.addGameObjectAtPos(new AddTimeEffect,this,e.x-Constants.CELL_SIZE/2,e.y-Constants.CELL_SIZE/2)}}if(this.score>=this.scoreGoal){updateShare(myPlayGameLevel,myPlayGameScore);Play68.setRankingLevelScoreDesc(myPlayGameLevel,myPlayGameScore);this.finishRound()}};t.prototype.tryShowSuperb=function(e,t){if(this.matchInARow>=3&&this.superbEffectTime!=this.liveTime){this.superbEffectTime=this.liveTime;var n=new SuperbEffect;this.addGameObjectAtPos(n,this,e,t);if(n.x<120){n.x=120}if(n.x>Constants.ASSETS_WIDTH-120){n.x=Constants.ASSETS_WIDTH-120}return true}return false};t.prototype.tryShowAwesome=function(e,t){if(this.matchInARow==2&&this.awesomeEffectTime!=this.liveTime){this.awesomeEffectTime=this.liveTime;var n=new ShowAwesomeEffect;this.addGameObjectAtPos(n,this,e,t);if(n.x<120){n.x=120}if(n.x>Constants.ASSETS_WIDTH-120){n.x=Constants.ASSETS_WIDTH-120}return true}return false};t.prototype.findMoves=function(){if(this.tutorial){this.tutorial.setHintIndeces();return true}var e=[[2,-1],[3,0],[2,1]];var t=[[-1,-1],[-2,0],[-1,1]];var n=[[1,-1],[1,1]];for(var r=0;r<this.fieldHeight;r++){for(var i=0;i<this.fieldWidth-1;i++){if(this.field[i][r].getColorID()==this.field[i+1][r].getColorID()){if(this.findPattern(i,r,this.field[i][r].getColorID(),e,i+2,r)){return true}if(this.findPattern(i,r,this.field[i][r].getColorID(),t,i-1,r)){return true}}}}for(var r=0;r<this.fieldHeight;r++){for(var i=0;i<this.fieldWidth-2;i++){if(this.field[i][r].getColorID()==this.field[i+2][r].getColorID()){if(this.findPattern(i,r,this.field[i][r].getColorID(),n,i+1,r)){return true}}}}var s=[[-1,2],[0,3],[1,2]];var o=[[-1,-1],[0,-2],[1,-1]];var u=[[-1,1],[1,1]];for(var r=0;r<this.fieldHeight-1;r++){for(var i=0;i<this.fieldWidth;i++){if(this.field[i][r].getColorID()==this.field[i][r+1].getColorID()){if(this.findPattern(i,r,this.field[i][r].getColorID(),s,i,r+2)){return true}if(this.findPattern(i,r,this.field[i][r].getColorID(),o,i,r-1)){return true}}}}for(var r=0;r<this.fieldHeight-2;r++){for(var i=0;i<this.fieldWidth;i++){if(this.field[i][r].getColorID()==this.field[i][r+2].getColorID()){if(this.findPattern(i,r,this.field[i][r].getColorID(),u,i,r+1)){return true}}}}return false};t.prototype.findPattern=function(e,t,n,r,i,s){if(n<0){return false}for(var o=0;o<r.length;o++){if(this.getColorAt(e+r[o][0],t+r[o][1])==n){this.findedMatchPos1=new createjs.Point(i,s);this.findedMatchPos2=new createjs.Point(e+r[o][0],t+r[o][1]);return true}}return false};t.prototype.setHintIndeces=function(e,t,n,r){this.findedMatchPos1=new createjs.Point(e,t);this.findedMatchPos2=new createjs.Point(n,r)};t.prototype.getColorAt=function(e,t){if(e<0||t<0||e>=this.fieldWidth||t>=this.fieldHeight||!this.field[e][t]){return-1}return this.field[e][t].getColorID()};t.prototype.onShiftEnded=function(){if(this.liveTime!=this.lastDropSoundTime){this.lastDropSoundTime=this.liveTime;var e=Utils.RandomRangeInt(0,2);while(e==this.lastDropID){e=Utils.RandomRangeInt(0,2)}this.lastDropID=e;switch(e){case 0:SoundManager.g_instance.play(SoundManager.SOUND_DROP_1);break;case 1:SoundManager.g_instance.play(SoundManager.SOUND_DROP_2);break;case 2:SoundManager.g_instance.play(SoundManager.SOUND_DROP_3);break}}};t.prototype.configureYAlign=function(){if(Constants.g_isPC){return}if(StateManager.g_instance.isLandscape()){this.y=100}else{if(Constants.SCREEN_HEIGHT<Constants.ASSETS_HEIGHT){this.y=Constants.SCREEN_HEIGHT-Constants.ASSETS_HEIGHT}else{if(Constants.SCREEN_HEIGHT>Constants.ASSETS_HEIGHT){this.y=(Constants.SCREEN_HEIGHT-Constants.ASSETS_HEIGHT)/2}}}};t.prototype.getTutorialSpawnNewID=function(){if(this.spawnCounter>=this.spawnIDS.length){return Utils.RandomRangeInt(1,this.chipTypesCount)}return this.spawnIDS[this.spawnCounter++]};t.prototype.stopTutorial=function(){t.needShowTutorial=false;if(this.tutorial){this.tutorial.kill();this.tutorial=null}};t.needShowTutorial=true;t.needShowAcidTutorial=true;t.timeLeftByRound=[180,160,120,110,100,95,90,85,80,75,70,65];t.scoreGoalsByRound=[3e3,6e3,1e4,15e3,21e3,28e3];return t}(GameState)